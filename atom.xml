<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>/</id>
    <title>anhoderçš„è¿›é˜¶æ—¥å¿—</title>
    <updated>2021-09-05T16:18:47.115Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="/"/>
    <link rel="self" href="/atom.xml"/>
    <subtitle>ä¸€å·çƒŸè‰ï¼Œæ»¡åŸé£çµ®ã€‚</subtitle>
    <logo>/images/avatar.png</logo>
    <icon>/favicon.ico</icon>
    <rights>All rights reserved 2021, anhoderçš„è¿›é˜¶æ—¥å¿—</rights>
    <entry>
        <title type="html"><![CDATA[PHPæ‰©å±•å¼€å‘â€”â€”ç±»]]></title>
        <id>/post/AeTXbWbCO/</id>
        <link href="/post/AeTXbWbCO/">
        </link>
        <updated>2021-08-08T10:22:10.000Z</updated>
        <content type="html"><![CDATA[<p>è¿™ç¯‡å¼€å§‹åœ¨æ‰©å±•ä¸­å®ç°PHPçš„ç±»ï¼Œå…ˆå®šä¸ªç›®æ ‡ï¼Œå®ç°å¦‚ä¸‹çš„PHPç±»ï¼š</p>
<pre><code class="language-php">&lt;?php

class Person {
    public const MALE = 1;
    public const FEMALE = 2;

    private $name;
    private $age;

    public function __construct(string $name, string $age)
    {
        $this-&gt;name = $name;
        $this-&gt;age = $age;
    }

    public function setName(string $name)
    {
        $this-&gt;name = $name;
    }

    public function getName(): string
    {
        return $this-&gt;name;
    }
}
</code></pre>
<h2 id="ç›¸å…³ç»“æ„ä½“-å®åŠå‡½æ•°">ç›¸å…³ç»“æ„ä½“ã€å®åŠå‡½æ•°</h2>
<ul>
<li>zend_class_entry: ç±»å…¥å£</li>
<li>PHP_METHOD: å£°æ˜ç±»çš„æ–¹æ³•</li>
<li>zend_update_property: æ›´æ–°ç±»çš„å±æ€§</li>
<li>zend_read_property: è·å–ç±»çš„å±æ€§</li>
<li>PHP_ME: ç±»æ–¹æ³•çš„å‚æ•°ä¿¡æ¯</li>
<li>INIT_CLASS_ENTRY: åˆå§‹åŒ–zend_class_entry</li>
<li>zend_register_internal_class: å‘zendä¸­æ³¨å†Œç±»</li>
<li>zend_declare_property: å£°æ˜å±æ€§</li>
</ul>
<h2 id="å®ç°personç±»">å®ç°Personç±»</h2>
<h3 id="1-å£°æ˜ç±»å…¥å£-å®ç°ç±»æ–¹æ³•">1. å£°æ˜ç±»å…¥å£ã€å®ç°ç±»æ–¹æ³•</h3>
<pre><code class="language-c">// ç±»å…¥å£
zend_class_entry *person_ce;


// __construct(string name, int age)
PHP_METHOD(Person, __construct)
{
    zend_string *name;
    zend_long age;

    ZEND_PARSE_PARAMETERS_START(2, 2)
        Z_PARAM_STR(name)
        Z_PARAM_LONG(age)
    ZEND_PARSE_PARAMETERS_END();

    // æ›´æ–°å±æ€§
    zend_update_property_str(person_ce, getThis(), &quot;name&quot;, sizeof(&quot;name&quot;)-1, name);
    zend_update_property_long(person_ce, getThis(), &quot;age&quot;, sizeof(&quot;age&quot;)-1, age);

    zend_string_release(name);
}

// getName(): string
PHP_METHOD(Person, getName)
{
    zval rv, *name;

    name = zend_read_property(person_ce, getThis(), &quot;name&quot;, sizeof(&quot;name&quot;)-1, 0, &amp;rv);

    RETURN_STR(Z_STR_P(name))
}

// setName(string name)
PHP_METHOD(Person, setName)
{
    zend_string *name;

    ZEND_PARSE_PARAMETERS_START(1, 1)
        Z_PARAM_STR(name)
    ZEND_PARSE_PARAMETERS_END();

    zend_update_property_str(person_ce, getThis(), &quot;name&quot;, sizeof(&quot;name&quot;)-1, name);

    zend_string_release(name);
}
</code></pre>
<h3 id="2-æ–¹æ³•å‚æ•°ä¿¡æ¯">2. æ–¹æ³•å‚æ•°ä¿¡æ¯</h3>
<pre><code class="language-c">ZEND_BEGIN_ARG_INFO(arginfo_person_construct, 0)
    ZEND_ARG_TYPE_INFO(0, name, IS_STRING, 0)
    ZEND_ARG_TYPE_INFO(0, age, IS_LONG, 0)
ZEND_END_ARG_INFO()

ZEND_BEGIN_ARG_INFO(arginfo_person_setname, 0)
    ZEND_ARG_TYPE_INFO(0, name, IS_STRING, 0)
ZEND_END_ARG_INFO()
</code></pre>
<h3 id="3-æ–¹æ³•å…¥å£">3. æ–¹æ³•å…¥å£</h3>
<p>ä¸æ™®é€šå‡½æ•°ä¸€æ ·ï¼Œéƒ½æ˜¯ä½¿ç”¨<code>zend_function_entry</code>ç»“æ„ä½“ä½œä¸ºå…¥å£ï¼Œä¸åŒçš„åªæ˜¯æŠŠå®æ¢æˆäº†<code>PHP_ME</code>ã€‚</p>
<pre><code class="language-c">zend_function_entry person_methods[] = {
    // ZEND_ACC_PUBLIC, æ–¹æ³•è®¿é—®æƒé™éƒ½ä¸ºpublic
    PHP_ME(Person, __construct, arginfo_person_construct, ZEND_ACC_PUBLIC)
    PHP_ME(Person, getName, NULL, ZEND_ACC_PUBLIC)
    PHP_ME(Person, setName, arginfo_person_setname, ZEND_ACC_PUBLIC)

    PHP_FE_END
};
</code></pre>
<h3 id="4-å‘zendæ³¨å†Œç±»">4. å‘Zendæ³¨å†Œç±»</h3>
<p>æœ€ååœ¨æ‰©å±•åˆå§‹åŒ–çš„Hookä¸­ï¼Œå°†ç±»æ³¨å†Œåˆ°Zendä¸­ã€‚</p>
<pre><code class="language-c">PHP_MINIT_FUNCTION(ext_test)
{
    // åˆå§‹åŒ–zend_class_entryï¼Œå°†æ–¹æ³•ç»‘å®šåˆ°ç±»ä¸­
    zend_class_entry ce;
    INIT_CLASS_ENTRY(ce, &quot;Person&quot;, person_methods)

    // æ³¨å†Œç±»
    person_ce = zend_register_internal_class(&amp;ce);

    // å£°æ˜ç±»å¸¸é‡
    zend_declare_class_constant_long(person_ce, &quot;MALE&quot;, sizeof(&quot;MALE&quot;)-1, 1);
    zend_declare_class_constant_long(person_ce, &quot;FEMALE&quot;, sizeof(&quot;FEMALE&quot;)-1, 2);

    // å£°æ˜ç±»çš„å±æ€§åŠè®¿é—®æƒé™
    zend_declare_property_null(person_ce, &quot;name&quot;, sizeof(&quot;name&quot;)-1, ZEND_ACC_PRIVATE);
    zend_declare_property_null(person_ce, &quot;age&quot;, sizeof(&quot;age&quot;)-1, ZEND_ACC_PRIVATE);
}
</code></pre>
<p>è‡³æ­¤ï¼Œç±»çš„å®ç°åŸºæœ¬å®Œæˆï¼Œå¤§è‡´æ­¥éª¤ä¸ºï¼š</p>
<ol>
<li>å£°æ˜ç±»å…¥å£</li>
<li>å®ç°ç›¸å…³çš„æ–¹æ³•</li>
<li>å£°æ˜æ–¹æ³•å‚æ•°ä¿¡æ¯</li>
<li>å£°æ˜æ–¹æ³•å…¥å£</li>
<li>åœ¨æ‰©å±•åˆå§‹åŒ–çš„Hookä¸­æ³¨å†Œåˆ°Zendä¸­</li>
</ol>
<h2 id="æµ‹è¯•phpä»£ç ">æµ‹è¯•PHPä»£ç </h2>
<pre><code class="language-php">&lt;?php

$person = new Person('anhoder', 18);
var_dump($person-&gt;getName());
$person-&gt;setName('alan');
var_dump($person);
</code></pre>
<p>è¾“å‡ºä»£ç ï¼š</p>
<pre><code>string(7) &quot;anhoder&quot;
object(Person)#1 (2) {
  [&quot;name&quot;:&quot;Person&quot;:private]=&gt;
  string(4) &quot;alan&quot;
  [&quot;age&quot;:&quot;Person&quot;:private]=&gt;
  int(18)
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[PHPæ‰©å±•å¼€å‘â€”â€”å‡½æ•°]]></title>
        <id>/post/yBxcxmgZ6/</id>
        <link href="/post/yBxcxmgZ6/">
        </link>
        <updated>2021-08-01T11:38:46.000Z</updated>
        <content type="html"><![CDATA[<p>è¿™é‡Œäº†è§£ä¸€ä¸‹æ‰©å±•å¼€å‘ä¸­PHPå‡½æ•°æ˜¯å¦‚ä½•å®ç°çš„ï¼ŒåŒ…æ‹¬å‚æ•°è§£æã€è¿”å›ç»“æœç­‰ã€‚</p>
<h2 id="0-å‡½æ•°ç›¸å…³å®">0. å‡½æ•°ç›¸å…³å®</h2>
<p>å¼€å§‹ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸€ä¸‹PHPä¸­ä¸€äº›ä¸å‡½æ•°ç›¸å…³çš„ç»“æ„æˆ–å®ã€‚</p>
<h3 id="å‡½æ•°å®šä¹‰php_functionname">å‡½æ•°å®šä¹‰ï¼š<code>PHP_FUNCTION(name)</code></h3>
<p><code>PHP_FUNCTION</code>æ˜¯ä¸€ä¸ªç”¨äºå®šä¹‰PHPå‡½æ•°å¤´çš„å®ï¼Œä½¿ç”¨æ–¹æ³•ï¼š</p>
<pre><code class="language-c">PHP_FUNCTION(func_name)
{
    // å‡½æ•°ä½“
}
</code></pre>
<blockquote>
<p>è¿™é‡Œé¡ºä¾¿è®²ä¸€ä¸‹<code>PHP_FUNCTION</code>, <code>ZEND_FUNCTION</code>, <code>PHP_METHOD</code>, <code>ZEND_METHOD</code>çš„å…³ç³»ã€‚</p>
<ul>
<li><code>PHP_FUNCTION</code>ç”¨äºå®šä¹‰PHPå‡½æ•°ï¼Œ<code>PHP_METHOD</code>ç”¨äºå®šä¹‰ç±»çš„æ–¹æ³•ã€‚</li>
<li><code>ZEND_FUNCTION</code>ä¸<code>PHP_FUNCTION</code>æ˜¯ç­‰æ•ˆçš„ï¼Œ<code>PHP_FUNCTION</code>åªæ˜¯<code>ZEND_FUNCTION</code>çš„åˆ«åï¼Œ<code>PHP_METHOD</code>ä¸<code>ZEND_METHOD</code>ä¹Ÿæ˜¯è¿™æ ·çš„å…³ç³»ã€‚</li>
</ul>
</blockquote>
<h3 id="å‡½æ•°å‚æ•°zend_begin_arg_infoname-_unused-zend_end_arg_info-zend_arg_infopass_by_ref-name">å‡½æ•°å‚æ•°ï¼š<code>ZEND_BEGIN_ARG_INFO(name, _unused)</code>ã€<code>ZEND_END_ARG_INFO()</code>ã€<code>ZEND_ARG_INFO(pass_by_ref, name)</code></h3>
<p><code>ZEND_BEGIN_ARG_INFO</code>ä¸<code>ZEND_END_ARG_INFO</code>æ˜¯é…å¯¹ä½¿ç”¨çš„ï¼Œç”¨äºå£°æ˜å‚æ•°ç»„ï¼Œå®ƒä»¬çš„å®å±•å¼€ä¸ºï¼š</p>
<pre><code class="language-c">// ZEND_BEGIN_ARG_INFO(name, _unused)å±•å¼€ï¼ˆ_unusedå…¶å®æ²¡æœ‰è¢«ä½¿ç”¨åˆ°ï¼‰
static const zend_internal_arg_info name[] = { \
		{ (const char*)(zend_uintptr_t)(required_num_args), 0, return_reference, 0 },

// ZEND_END_ARG_INFO()å±•å¼€
};
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå®ƒä»¬åœ¨ä¸€èµ·å®é™…æ˜¯å£°æ˜äº†ä¸€ä¸ªzend_internal_arg_infoæ•°ç»„ï¼Œç”¨äºå­˜å‚¨ä¸€ç³»åˆ—å‚æ•°ä¿¡æ¯ã€‚</p>
<p>è€Œ<code>ZEND_ARG_INFO</code>åˆ™æ˜¯åœ¨<code>ZEND_BEGIN_ARG_INFO</code>ä¸<code>ZEND_END_ARG_INFO</code>ä¹‹é—´ï¼Œç”¨äºåˆå§‹åŒ–ä¸€ä¸ªzend_internal_arg_infoï¼Œå®šä¹‰æŸä¸ªå…·ä½“çš„å‚æ•°ï¼Œå®ƒçš„å®å®šä¹‰ä¸ºï¼š</p>
<pre><code class="language-c">#define ZEND_ARG_INFO(pass_by_ref, name)    { #name, 0, pass_by_ref, 0},
</code></pre>
<blockquote>
<p>ZEND_ARG_INFOç”¨äºå£°æ˜æ™®é€šå‚æ•°ï¼Œå¤æ‚å‚æ•°éœ€è¦ä½¿ç”¨å¦å¤–çš„å®ï¼š</p>
<ul>
<li>ZEND_ARG_OBJ_INFO â€”â€” å¯¹è±¡</li>
<li>ZEND_ARG_ARRAY_INFO â€”â€” æ•°ç»„<br>
...</li>
</ul>
</blockquote>
<h3 id="å‡½æ•°å…¥å£zend_function_entryç»“æ„ä½“-php_fename-arg_info">å‡½æ•°å…¥å£ï¼š<code>zend_function_entry</code>ç»“æ„ä½“ã€<code>PHP_FE(name, arg_info)</code></h3>
<p><code>zend_function_entry</code>æ˜¯ç”¨äºå‘Zendå¼•æ“ä¸­æ³¨å†Œå‡½æ•°çš„è½½ä½“ï¼Œæ¯ä¸ªéœ€è¦æä¾›ç»™PHPçš„å‡½æ•°éƒ½å¯¹åº”ä¸€ä¸ª<code>zend_function_entry</code>ã€‚</p>
<p>ä½¿ç”¨ï¼š</p>
<pre><code class="language-c">// è¿™æ˜¯ä¸€æ®µext_sketè„šæ‰‹æ¶ç”Ÿæˆçš„ä»£ç 
// zend_function_entryæ•°ç»„
static const zend_function_entry ext_test_functions[] = {
    // å‡½æ•°
    PHP_FE(ext_test_test1,		arginfo_ext_test_test1)
	PHP_FE_END
};

zend_module_entry ext_test_module_entry = {
	STANDARD_MODULE_HEADER,
	&quot;ext_test&quot;,					/* Extension name */
	ext_test_functions,			// å‘Zendå¼•æ“ä¸­æ³¨å†Œä¸€ç³»åˆ—å‡½æ•°
	NULL,							/* PHP_MINIT - Module initialization */
	NULL,							/* PHP_MSHUTDOWN - Module shutdown */
	PHP_RINIT(ext_test),			/* PHP_RINIT - Request initialization */
	NULL,							/* PHP_RSHUTDOWN - Request shutdown */
	PHP_MINFO(ext_test),			/* PHP_MINFO - Module info */
	PHP_EXT_TEST_VERSION,		/* Version */
	STANDARD_MODULE_PROPERTIES
};
</code></pre>
<p><code>PHP_FE</code>å°±æ˜¯ç”¨äºåˆå§‹åŒ–ä¸€ä¸ª<code>zend_function_entry</code>ç»“æ„ä½“çš„ã€‚éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼šå‡½æ•°ååŠå‚æ•°ä¿¡æ¯zend_internal_arg_info[]ã€‚</p>
<h3 id="å‚æ•°è§£æzend_parse_parameters_none-zend_parse_parameters_startmin_num_args-max_num_args-zend_parse_parameters_end-z_param_optional-z_param_">å‚æ•°è§£æï¼š<code>ZEND_PARSE_PARAMETERS_NONE()</code>ã€<code>ZEND_PARSE_PARAMETERS_START(min_num_args, max_num_args)</code>ã€<code>ZEND_PARSE_PARAMETERS_END()</code>ã€<code>Z_PARAM_OPTIONAL</code>ã€<code>Z_PARAM_*</code></h3>
<p>è¿™ä¸€ç±»å®ç”¨åœ¨å‡½æ•°ä½“å†…ï¼Œå³<code>PHP_FUNCTION</code>ä¸­ã€‚</p>
<ul>
<li><code>ZEND_PARSE_PARAMETERS_NONE()</code>: æ— éœ€è¦å‚æ•°</li>
<li><code>ZEND_PARSE_PARAMETERS_START(min_num_args, max_num_args)</code>: å¼€å§‹å‚æ•°è§£æï¼Œmin_num_argsæœ€å°‘å‚æ•°æ•°é‡ï¼Œmax_num_argsæœ€å¤§å‚æ•°æ•°é‡</li>
<li><code>ZEND_PARSE_PARAMETERS_END()</code>: ç»“æŸå‚æ•°è§£æï¼Œä¸<code>ZEND_PARSE_PARAMETERS_START</code>æˆå¯¹ä½¿ç”¨</li>
<li><code>Z_PARAM_OPTIONAL</code>: è¡¨ç¤ºå‚æ•°å¯é€‰</li>
<li><code>Z_PARAM_*</code>: å…·ä½“å‚æ•°</li>
</ul>
<p>ä½¿ç”¨æ–¹æ³•ï¼š</p>
<pre><code class="language-c">// æ— å‚æ•°å‡½æ•°
PHP_FUNCITON(test_func)
{
    ZEND_PARSE_PARAMETERS_NONE();
    zend_printf(&quot;test&quot;); // zend_printfä¸php_printfç­‰æ•ˆï¼ŒPHPåœ¨å¯åŠ¨æ—¶ä¼šå°†php_printfèµ‹å€¼ç»™zend_printfæŒ‡é’ˆ
}

PHP_FUNCTION(test_func2)
{
    ZEND_PARSE_PARAMETERS_START(1, 2)
        Z_PARAM_S
        Z_PARAM_OPTIONAL()
    ZEND_PARSE_PARAMETERS_END();
}
</code></pre>
<h2 id="1-æ— å‚æ— è¿”å›å€¼å‡½æ•°">1. æ— å‚æ— è¿”å›å€¼å‡½æ•°</h2>
<pre><code class="language-c">// ...

// test_func1(): void
PHP_FUNCTION(test_func1)
{
	ZEND_PARSE_PARAMETERS_NONE();

	php_printf(&quot;Hello world!&quot;);
}

// ...

ZEND_BEGIN_ARG_INFO(arginfo_test_func1, 0)
ZEND_END_ARG_INFO()

static const zend_function_entry ext_test_functions[] = {
    PHP_FE(test_func1,		arginfo_test_func1)
	PHP_FE_END
};

// ...
</code></pre>
<pre><code class="language-php">test_func1(); // è¾“å‡ºHello world!
</code></pre>
<h2 id="2-å¸¦å›ºå®šç±»å‹å‚æ•°ä¸”æœ‰è¿”å›å€¼çš„å‡½æ•°">2. å¸¦å›ºå®šç±»å‹å‚æ•°ï¼Œä¸”æœ‰è¿”å›å€¼çš„å‡½æ•°</h2>
<pre><code class="language-c">// test_func2(int id, string name=&quot;anhoder&quot;): string
PHP_FUNCTION(test_func2)
{
    zend_long id;
    zend_string *name, *res;
    name = zend_string_init(&quot;anhoder&quot;, strlen(&quot;anhoder&quot;), 0);

    ZEND_PARSE_PARAMETERS_START(1, 2)
        Z_PARAM_LONG(id)
        Z_PARAM_OPTIONAL
        Z_PARAM_STR(name)
    ZEND_PARSE_PARAMETERS_END();

    res = zend_strpprintf(0, &quot;%lld: %s\n&quot;, id, ZSTR_VAL(name));

    RETVAL_STR(res);

    zend_string_release(name);
    zend_string_release(res);
}

// ...

ZEND_BEGIN_ARG_INFO(arginfo_test_func2, 0)
	ZEND_ARG_TYPE_INFO(0, id, IS_LONG, 0)
    ZEND_ARG_TYPE_INFO(0, name, IS_STRING, 0)
ZEND_END_ARG_INFO()

static const zend_function_entry ext_test_functions[] = {
    PHP_FE(test_func2,		arginfo_test_func2)
	PHP_FE_END
};

// ...
</code></pre>
<h2 id="3-å‚æ•°ä¼ å¼•ç”¨çš„å‡½æ•°">3. å‚æ•°ä¼ å¼•ç”¨çš„å‡½æ•°</h2>
<pre><code class="language-c">// test_func3(array &amp;$arr): void
PHP_FUNCTION(test_func3)
{
    zval *arr;

    ZEND_PARSE_PARAMETERS_START(1, 1)
        Z_PARAM_ARRAY_EX2(arr, 0, 1, 0)
    ZEND_PARSE_PARAMETERS_END();

    add_assoc_long(arr, &quot;key&quot;, 123);
    add_index_string(arr, 4, &quot;name&quot;);
}

ZEND_BEGIN_ARG_INFO(arginfo_test_func3, 0)
    ZEND_ARG_TYPE_INFO(1, arr, IS_ARRAY, 0)
ZEND_END_ARG_INFO()

static const zend_function_entry ext_test_functions[] = {
    PHP_FE(test_func3,		arginfo_test_func3)
	PHP_FE_END
};
</code></pre>
<h2 id="4-å‚æ•°ä¼ å¯¹è±¡-callableçš„å‡½æ•°">4. å‚æ•°ä¼ å¯¹è±¡ã€callableçš„å‡½æ•°</h2>
<pre><code class="language-c">// mixed test_func4(callable, ...args)
PHP_FUNCTION(test_func4)
{
    zval result;
    zend_fcall_info fci;
    zend_fcall_info_cache fcc;

    ZEND_PARSE_PARAMETERS_START(2, -1)
        Z_PARAM_FUNC(fci, fcc)
        Z_PARAM_VARIADIC('*', fci.params, fci.param_count)
    ZEND_PARSE_PARAMETERS_END();

    fci.retval = &amp;result;

    if (zend_call_function(&amp;fci, &amp;fcc) != SUCCESS) {
        return;
    }

    RETURN_ZVAL(&amp;result, 1, 0);
}

ZEND_BEGIN_ARG_INFO(arginfo_test_func4, 0)
    ZEND_ARG_TYPE_INFO(0, callable, IS_CALLABLE, 0)
    ZEND_ARG_INFO(0, args)
ZEND_END_ARG_INFO()

static const zend_function_entry ext_test_functions[] = {
    PHP_FE(test_func4,		arginfo_test_func4)
	PHP_FE_END
};
</code></pre>
<h2 id="ä»¥ä¸Šå‡ ä¸ªå‡½æ•°çš„phpæµ‹è¯•ä»£ç ">ä»¥ä¸Šå‡ ä¸ªå‡½æ•°çš„PHPæµ‹è¯•ä»£ç </h2>
<pre><code class="language-php">&lt;?php

test_func1();

var_dump(test_func2(1));
var_dump(test_func2(2, 'test'));

$arr = [1,2];
test_func3($arr);
var_dump($arr);


$callback = function (...$args) {
    foreach ($args as $arg) {
        var_dump($arg);
    }
};
test_func4($callback, 1, 2, 3, 'str1', 'str2');
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[PHPæ‰©å±•å¼€å‘â€”â€”å‡†å¤‡]]></title>
        <id>/post/2es0g0FAq/</id>
        <link href="/post/2es0g0FAq/">
        </link>
        <updated>2021-08-01T07:37:24.000Z</updated>
        <summary type="html"><![CDATA[<p>åœ¨å¼€å‘æ‰©å±•ä¹‹å‰ï¼Œéœ€è¦åšä¸€äº›å‡†å¤‡å·¥ä½œï¼šè„šæ‰‹æ¶ä½¿ç”¨ã€ç¯å¢ƒé…ç½®ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>åœ¨å¼€å‘æ‰©å±•ä¹‹å‰ï¼Œéœ€è¦åšä¸€äº›å‡†å¤‡å·¥ä½œï¼šè„šæ‰‹æ¶ä½¿ç”¨ã€ç¯å¢ƒé…ç½®ã€‚</p>
<!-- more -->
<h2 id="ç”ŸæˆåŸºæœ¬éª¨æ¶">ç”ŸæˆåŸºæœ¬éª¨æ¶</h2>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å®˜æ–¹æä¾›çš„<code>ext_skel</code>è„šæœ¬æ¥ç”Ÿæˆæ‰©å±•çš„å¤§è‡´éª¨æ¶å’ŒåŸºç¡€ä»£ç ã€‚</p>
<pre><code class="language-sh">./ext_skel.php --ext ext_test # ext_testä¸ºæ‰©å±•åç§°
</code></pre>
<p>è¿™ä¸ªè„šæœ¬åœ¨phpæºç ä¸­å¯ä»¥æ‰¾åˆ°ï¼Œå…·ä½“è·¯å¾„ä¸º<code>php-src/ext/ext_skel</code>ã€‚</p>
<blockquote>
<p>php 7.3ä¹‹å‰æ˜¯ç”¨shellå†™çš„è„šæœ¬ï¼Œä¹‹åæ˜¯ç”¨phpå†™çš„ã€‚</p>
</blockquote>
<p>æ‰§è¡Œå®Œä¸Šè¿°å‘½ä»¤åï¼Œå°±ä¼šç”Ÿæˆæ‰©å±•éª¨æ¶ï¼š</p>
<pre><code class="language-sh">ext_test/
â”œâ”€â”€ config.m4       # unixç¼–è¯‘é…ç½®
â”œâ”€â”€ config.w32      # windowsç¼–è¯‘é…ç½®
â”œâ”€â”€ ext_test.c      # ä¸»è¦cä»£ç 
â”œâ”€â”€ php_ext_test.h  # ä¸»è¦å¤´æ–‡ä»¶
â””â”€â”€ tests           # æµ‹è¯•
    â”œâ”€â”€ 001.phpt
    â”œâ”€â”€ 002.phpt
    â””â”€â”€ 003.phpt
</code></pre>
<h2 id="ç¯å¢ƒé…ç½®">ç¯å¢ƒé…ç½®</h2>
<p>è¿™é‡Œæˆ‘æ˜¯ç”¨JetBrainså®¶çš„CLionä½œä¸ºå¼€å‘ç¯å¢ƒï¼Œå…·ä½“é…ç½®æ­¥éª¤ä¸ºï¼š</p>
<h3 id="1-åˆ›å»ºcmakeliststxtæ–‡ä»¶">1. åˆ›å»º<code>CMakeLists.txt</code>æ–‡ä»¶</h3>
<figure data-type="image" tabindex="1"><img src="/post-images/1627807380037.png" alt="" loading="lazy"></figure>
<p>ç‚¹å‡»<code>Create CMakeLists.txt</code>ä¼šç”Ÿæˆå¦‚ä¸‹çš„æ–‡ä»¶å†…å®¹ï¼š</p>
<pre><code class="language-c">cmake_minimum_required(VERSION 3.20)
project(ext_test C)

set(CMAKE_C_STANDARD 11)

include_directories(.)

add_executable(ext_test
        ext_test.c
        php_ext_test.h)
</code></pre>
<h3 id="2-åŠ è½½phpå¤´æ–‡ä»¶">2. åŠ è½½PHPå¤´æ–‡ä»¶</h3>
<p>æ­¤æ—¶æ‰“å¼€Cæ–‡ä»¶<code>ext_test.c</code>ä¼šæœ‰ä¸€äº›æŠ¥çº¢ï¼Œæˆ‘ä»¬éœ€è¦åœ¨CMakeLists.txtä¸­å¢åŠ å¦‚ä¸‹ä»£ç ï¼Œå°†PHPçš„å¤´æ–‡ä»¶ä¹ŸåŠ è½½è¿›æ¥å³å¯ï¼š</p>
<pre><code class="language-c">include_directories(/usr/local/include/php)
include_directories(/usr/local/include/php/main)
include_directories(/usr/local/include/php/Zend)
</code></pre>
<p>å‡†å¤‡å·¥ä½œå®Œæˆäº†ï¼Œåé¢å°±ä¼šå¼€å§‹å®ç°æ‰©å±•çš„ä¸€äº›å…·ä½“åŠŸèƒ½ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[PHPæ‰©å±•å¼€å‘â€”â€”EXPECTEDä¸UNEXPECTED]]></title>
        <id>/post/c3xK30m15/</id>
        <link href="/post/c3xK30m15/">
        </link>
        <updated>2021-07-31T16:32:55.000Z</updated>
        <summary type="html"><![CDATA[<p>åœ¨PHPæ‰©å±•å¼€å‘ä¸­ï¼Œç»å¸¸ä¼šçœ‹åˆ°<code>EXPECTED</code>ä¸<code>UNEXPECTED</code>ä¸¤ä¸ªå®çš„ä½¿ç”¨ï¼Œä½†æ˜¯å´ä¸æ¸…æ¥šå®ƒä»¬çš„ç”¨é€”ï¼Œè¿™æ¬¡å°±æ¥æ‹¨å¼€å®ƒä»¬çš„é¢çº±ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>åœ¨PHPæ‰©å±•å¼€å‘ä¸­ï¼Œç»å¸¸ä¼šçœ‹åˆ°<code>EXPECTED</code>ä¸<code>UNEXPECTED</code>ä¸¤ä¸ªå®çš„ä½¿ç”¨ï¼Œä½†æ˜¯å´ä¸æ¸…æ¥šå®ƒä»¬çš„ç”¨é€”ï¼Œè¿™æ¬¡å°±æ¥æ‹¨å¼€å®ƒä»¬çš„é¢çº±ã€‚</p>
<!-- more -->
<p>é¦–å…ˆä¸¾ä¸ªåœ¨PHPåº•å±‚ä¸­ä½¿ç”¨åˆ°<code>EXPECTED</code>ä¸<code>UNEXPECTED</code>çš„ä¾‹å­ï¼š</p>
<pre><code class="language-c">if (UNEXPECTED(_num_args &lt; _min_num_args) || \
    (UNEXPECTED(_num_args &gt; _max_num_args) &amp;&amp; \
        EXPECTED(_max_num_args &gt;= 0))) { \
    if (!(_flags &amp; ZEND_PARSE_PARAMS_QUIET)) { \
        if (_flags &amp; ZEND_PARSE_PARAMS_THROW) { \
            zend_wrong_parameters_count_exception(_min_num_args, _max_num_args); \
        } else { \
            zend_wrong_parameters_count_error(_min_num_args, _max_num_args); \
        } \
    } \
    error_code = ZPP_ERROR_FAILURE; \
    break; \
} \
</code></pre>
<p>è¿™æ˜¯Zendæä¾›ç”¨äºè§£æå‡½æ•°å‚æ•°çš„ä¸€ä¸ªå®çš„éƒ¨åˆ†ä»£ç ï¼Œå¤§è‡´ä»£ç é€»è¾‘å°±æ˜¯åˆ¤æ–­å‚æ•°æ•°é‡æ˜¯å¦ä¸æ­£ç¡®ã€‚åœ¨<code>zend_API.h</code>ä¸­ï¼Œ<code>EXPECTED</code>å’Œ<code>UNEXPECTED</code>æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š</p>
<pre><code class="language-c">#if PHP_HAVE_BUILTIN_EXPECT
# define EXPECTED(condition)   __builtin_expect(!!(condition), 1)
# define UNEXPECTED(condition) __builtin_expect(!!(condition), 0)
#else
# define EXPECTED(condition)   (condition)
# define UNEXPECTED(condition) (condition)
#endif
</code></pre>
<p>å¯ä»¥å‘ç°å®ƒä»¬å…¶å®æ˜¯å¯¹<code>__builtin_expect</code>å‡½æ•°çš„ä¸€ä¸ªå°è£…ï¼Œæ‰€ä»¥æœ€ç»ˆå°±æ˜¯è¦ææ¸…æ¥š<code>__builtin_expect</code>åˆ°åº•æ˜¯å¹²å˜›çš„ã€‚</p>
<blockquote>
<p>__builtin_expect()æ˜¯GCC v2.96ç‰ˆæœ¬å¼•å…¥çš„å†…å»ºå‡½æ•°ï¼Œæä¾›ç»™ç¨‹åºå‘˜åšåˆ†æ”¯é¢„æµ‹ã€‚</p>
</blockquote>
<p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ç¨‹åºå‘˜å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œåç»­çš„æ¡ä»¶åˆ¤æ–­ä¸­å¯èƒ½æ€§æœ€å¤§çš„æ¡ä»¶åˆ†æ”¯æ˜¯ä»€ä¹ˆï¼Œæ–¹ä¾¿ç¼–è¯‘å™¨é’ˆå¯¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œå°†å¯èƒ½æ€§æœ€å¤§çš„åˆ†æ”¯ä»£ç æ”¾åœ¨å‰é¢ï¼Œé™ä½æŒ‡ä»¤è·³è½¬çš„å¯èƒ½æ€§ï¼Œä»¥ä¼˜åŒ–æ€§èƒ½ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-c">// å‡å¦‚æœ‰aå˜é‡
if (EXPECTED(a == 0)) {
    // ...
} else {
    // ...
}
</code></pre>
<p>ä»¥ä¸Šä»£ç è¡¨ç¤ºï¼Œa == 0çš„å¯èƒ½æ€§æ›´å¤§ï¼Œå³æ›´æœ‰å¯èƒ½æ‰§è¡Œifåˆ†æ”¯ä»£ç ï¼Œæ­¤æ—¶ï¼Œç¼–è¯‘å™¨å°±ä¼šå°†ifåˆ†æ”¯ä»£ç æ”¾åœ¨å‰é¢ã€‚åä¹‹ï¼Œå¦‚æœä½¿ç”¨<code>UNEXPECTED</code>ï¼Œå°±ä¼šå°†elseåˆ†æ”¯ä»£ç æ”¾åœ¨å‰é¢ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[autotoolsçš„ä½¿ç”¨]]></title>
        <id>/post/jCJO8375A/</id>
        <link href="/post/jCJO8375A/">
        </link>
        <updated>2021-07-25T16:07:41.000Z</updated>
        <summary type="html"><![CDATA[<p>æœ€è¿‘æ·±å…¥å­¦ä¹ ä¸€ä¸‹PHPæ‰©å±•å¼€å‘ä»¥åŠCç›¸å…³çŸ¥è¯†ï¼Œå°±å…ˆä»autotoolså¼€å§‹å§ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>æœ€è¿‘æ·±å…¥å­¦ä¹ ä¸€ä¸‹PHPæ‰©å±•å¼€å‘ä»¥åŠCç›¸å…³çŸ¥è¯†ï¼Œå°±å…ˆä»autotoolså¼€å§‹å§ã€‚</p>
<!-- more -->
<h2 id="autotoolsæ˜¯ä»€ä¹ˆ">autotoolsæ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>autotoolsæ˜¯ä¸€ç³»åˆ—ç”¨äºè‡ªåŠ¨ç”Ÿæˆconfigureè„šæœ¬çš„å·¥å…·é›†ã€‚åŒ…æ‹¬autoconfã€automakeã€libtoolsã€‚</p>
<p>æœ€åˆï¼Œå·¥ç¨‹å¸ˆä»¬åœ¨è½¯ä»¶å¼€å‘å®Œä¹‹åï¼Œé€šå¸¸ä¼šé…å¥—åœ°ç¼–å†™ç›¸åº”çš„Makefileæ–‡ä»¶ï¼Œç”¨äºç¼–è¯‘å®‰è£…è‡ªå·±çš„ç¨‹åºï¼š</p>
<ol>
<li>ç¼–å†™Makefileæ–‡ä»¶</li>
<li><code>make</code></li>
<li><code>make install</code></li>
</ol>
<p>ä½†æ˜¯ï¼Œéšç€è½¯ä»¶å¤§èŒƒå›´æ¨å¹¿ä½¿ç”¨åï¼Œç¨‹åºå¯èƒ½éœ€è¦åœ¨ä¸åŒçš„å¹³å°ä¸Šè¿›è¡Œç¼–è¯‘å®‰è£…ï¼Œè€Œä¸åŒå¹³å°ä¹‹é—´çš„ç¼–è¯‘é€šå¸¸å­˜åœ¨è®¸å¤šå·®å¼‚ã€‚ä¸ºäº†é¿å…å®‰è£…æ—¶æ‰‹åŠ¨å»è°ƒæ•´Makefileï¼Œå·¥ç¨‹å¸ˆä»¬å¼€å§‹ç¼–å†™<code>configure</code>è„šæœ¬æ¥æ ¹æ®ä¸åŒå¹³å°ä»æ¨¡ç‰ˆæ–‡ä»¶ç”ŸæˆMakefileã€config.h(ä¸€äº›å®çš„å®šä¹‰)ï¼ŒMakefileçš„æ¨¡ç‰ˆæ–‡ä»¶æ˜¯Makefile.inã€config.hçš„æ¨¡ç‰ˆæ–‡ä»¶æ˜¯config.h.inã€‚å®‰è£…è½¯ä»¶çš„å¤§è‡´æµç¨‹ä¸ºï¼š</p>
<ol>
<li>æ‰§è¡Œ<code>configure</code>è„šæœ¬ç”ŸæˆMakefileã€config.h</li>
<li><code>make &amp;&amp; make install</code></li>
</ol>
<p>æ­¤æ—¶ï¼Œç›¸å…³æ–‡ä»¶æœ‰ä¸‰ä¸ªï¼šMakefileæ¨¡ç‰ˆæ–‡ä»¶<code>Makefile.in</code>ã€config.hæ¨¡ç‰ˆæ–‡ä»¶<code>config.h.in</code>ã€<code>configure</code>ã€‚</p>
<p>åæ¥ï¼Œäººä»¬è§‰å¾—è¿˜æ˜¯å¤ªéº»çƒ¦ï¼Œäºæ˜¯å¼€å‘äº†<code>autoconf</code>ç”¨æ¥è‡ªåŠ¨ç”Ÿæˆ<code>configure</code>è„šæœ¬ã€<code>automake</code>ç”¨äºç”ŸæˆMakefile.inæ¨¡ç‰ˆæ–‡ä»¶ã€<code>autoheader</code>ç”¨äºç”Ÿæˆconfig.h.inæ¨¡ç‰ˆæ–‡ä»¶ã€‚</p>
<blockquote>
<p>æ›´å¤šçš„ä¸€äº›ä»‹ç»åŠæµç¨‹ï¼Œå¯ä»¥å‚ç…§è¿™ç¯‡åšå®¢<a href="https://blog.csdn.net/weixin_42398658/article/details/107629877">https://blog.csdn.net/weixin_42398658/article/details/107629877</a></p>
</blockquote>
<h2 id="ç®€å•ä½¿ç”¨">ç®€å•ä½¿ç”¨</h2>
<p>è¿™é‡Œä½¿ç”¨ä¸€æ®µç®€å•çš„Cä»£ç æ¥åšæ¼”ç¤ºã€‚</p>
<h4 id="1-ç¼–å†™æºä»£ç ">1. ç¼–å†™æºä»£ç </h4>
<pre><code class="language-c">#include &lt;stdio.h&gt;

int main() {
    printf(&quot;Hello, world!\n&quot;);
    return 0;
}
</code></pre>
<p>å®Œæˆä¹‹åï¼Œå¯ä»¥ç›´æ¥æ‰‹åŠ¨ç¼–è¯‘å¹¶æ‰§è¡Œä¸€ä¸‹è¯•è¯•ï¼š<code>gcc main.c -o main &amp;&amp; ./main</code>ã€‚</p>
<h4 id="2-ä½¿ç”¨autoscanæ‰«ææºä»£ç ç”Ÿæˆconfigurescanæ–‡ä»¶">2. ä½¿ç”¨autoscanæ‰«ææºä»£ç ï¼Œç”Ÿæˆconfigure.scanæ–‡ä»¶</h4>
<pre><code class="language-sh">autoscan
</code></pre>
<figure data-type="image" tabindex="1"><img src="/post-images/1627660831826.PNG" alt="" loading="lazy"></figure>
<blockquote>
<p>autoscan.logæŒ‰åç§°æ¨æµ‹ï¼Œåº”è¯¥å°±æ˜¯autoscanå‘½ä»¤äº§ç”Ÿçš„ç›¸å…³æ—¥å¿—ã€‚<br>
configure.scanæ˜¯ä¸€ä¸ªé›å½¢æ–‡ä»¶ï¼Œéœ€è¦åœ¨å…¶åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ä¿å­˜ä¸ºconfigure.acã€‚</p>
</blockquote>
<h4 id="3-configurescanå¤åˆ¶ä¸ºconfigureacå¹¶ä¿®æ”¹å†…å®¹">3. configure.scanå¤åˆ¶ä¸ºconfigure.acï¼Œå¹¶ä¿®æ”¹å†…å®¹</h4>
<p>å°†configure.scanå¤åˆ¶ä¸ºconfigure.acï¼Œå¹¶ä¿®æ”¹ä»¥ä¸‹ä¸­æ–‡æ³¨é‡Šåå†…å®¹ï¼š</p>
<pre><code>#                                               -*- Autoconf -*-
# Process this file with autoconf to produce a configure script.

AC_PREREQ([2.71])

# åŸºç¡€ä¿¡æ¯
# AC_INIT([FULL-PACKAGE-NAME], [VERSION], [BUG-REPORT-ADDRESS])
AC_INIT(helloworld, 1.0.0, anhoder@88.com)

AC_CONFIG_SRCDIR([main.c])
AC_CONFIG_HEADERS([config.h])

# å¢åŠ automakeé…ç½®
AM_INIT_AUTOMAKE

# Checks for programs.
AC_PROG_CC

# Checks for libraries.

# Checks for header files.

# Checks for typedefs, structures, and compiler characteristics.

# Checks for library functions.

# ç”ŸæˆMakefile
AC_CONFIG_FILES(Makefile)

AC_OUTPUT
</code></pre>
<h4 id="4-aclocalç”Ÿæˆaclocalm4">4. aclocalç”Ÿæˆaclocal.m4</h4>
<pre><code class="language-sh">aclocal
</code></pre>
<figure data-type="image" tabindex="2"><img src="/post-images/1627660851848.JPG" alt="" loading="lazy"></figure>
<h4 id="5-autoconfç”Ÿæˆconfigureè„šæœ¬">5. autoconfç”Ÿæˆconfigureè„šæœ¬</h4>
<pre><code class="language-sh">autoconf
</code></pre>
<figure data-type="image" tabindex="3"><img src="/post-images/1627660860091.JPG" alt="" loading="lazy"></figure>
<p>æ­¤æ—¶ï¼Œconfigureè„šæœ¬å·²ç»æˆåŠŸç”Ÿæˆäº†ã€‚</p>
<h4 id="6-autoheaderç”Ÿæˆconfighin">6. autoheaderç”Ÿæˆconfig.h.in</h4>
<pre><code class="language-sh">autoheader
</code></pre>
<figure data-type="image" tabindex="4"><img src="/post-images/1627660868315.JPG" alt="" loading="lazy"></figure>
<p>config.h.inæ–‡ä»¶ä¹Ÿå·²ç”Ÿæˆã€‚</p>
<h4 id="7-ç¼–å†™makefileam">7. ç¼–å†™Makefile.am</h4>
<p>Makefile.amç”¨äºç”ŸæˆMakefile.inï¼Œéœ€è¦æ‰‹åŠ¨ç¼–å†™ï¼Œ<a href="https://www.gnu.org/software/automake/manual/automake.html">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<pre><code>bin_PROGRAMS=main
main_SOURCES=main.c
</code></pre>
<p>å°†ä¸Šè¿°å†…å®¹å†™å…¥åˆ°Makefile.amä¸­ï¼Œä¿å­˜ã€‚</p>
<h4 id="8-automakeç”Ÿæˆmakefilein">8. automakeç”ŸæˆMakefile.in</h4>
<pre><code class="language-sh">automake
</code></pre>
<figure data-type="image" tabindex="5"><img src="/post-images/1627660879049.JPG" alt="" loading="lazy"></figure>
<p>å‡ºç°äº†æŠ¥é”™ï¼Œéœ€è¦åŠ ä¸Š<code>--add-missing</code>é€‰é¡¹ã€‚</p>
<pre><code class="language-sh">automake --add-missing
</code></pre>
<figure data-type="image" tabindex="6"><img src="/post-images/1627660891520.JPG" alt="" loading="lazy"></figure>
<p>éœ€è¦æ·»åŠ å››ä¸ªæ–‡ä»¶ï¼Œæ‰‹åŠ¨åˆ›å»ºå†æ‰§è¡Œ<code>automake --add-missing</code>å³å¯ï¼š</p>
<pre><code class="language-sh">touch NEWS README AUTHORS ChangeLog
automake --add-missing
</code></pre>
<p>è‡³æ­¤ï¼Œä¸‰ä¸ªæ–‡ä»¶ï¼ˆconfigure, Makefile.in, config.h.inï¼‰å…¨éƒ¨ç”Ÿæˆå®Œæˆã€‚</p>
<blockquote>
<p>æŸ¥çœ‹configureï¼Œå…¶å®å°±æ˜¯ä¸ªshellè„šæœ¬ã€‚</p>
</blockquote>
<h4 id="9-æ‰§è¡Œconfigureè„šæœ¬-make">9. æ‰§è¡Œconfigureè„šæœ¬ã€make</h4>
<pre><code class="language-sh">./configure
make
</code></pre>
<figure data-type="image" tabindex="7"><img src="/post-images/1627660899653.JPG" alt="" loading="lazy"></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œconfigureè„šæœ¬ä¸»è¦æ˜¯åœ¨æ£€æŸ¥ç¯å¢ƒä»¥åŠç”ŸæˆMakefileã€config.hã€‚</p>
<p>ä¸¤ä¸ªå‘½ä»¤æ‰§è¡Œå®Œæˆï¼Œå³ç¼–è¯‘å‡ºäº†ç›¸åº”çš„äºŒè¿›åˆ¶æ–‡ä»¶<code>main</code>ï¼Œæ‰§è¡Œ<code>./main</code>æŸ¥çœ‹ç»“æœã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>è¿™é‡Œä¸»è¦ä»‹ç»äº†autotoolsçš„ç®€å•ä½¿ç”¨ï¼Œä¸ºåç»­PHPæ‰©å±•å¼€å‘çš„å­¦ä¹ åšé“ºå«ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[2021 PHPéƒ¨åˆ†é¢ç»]]></title>
        <id>/post/JeWf3QSkh/</id>
        <link href="/post/JeWf3QSkh/">
        </link>
        <updated>2021-06-14T15:27:14.000Z</updated>
        <summary type="html"><![CDATA[<p>å‰æ®µæ—¶é—´è¾èŒæ¢å·¥ä½œï¼Œå‚åŠ äº†ä¸€äº›é¢è¯•ï¼Œç°åœ¨ä¹Ÿå…¥èŒäº†ï¼Œè¶ç€è¿˜ä¸å¿™ç¨å¾®æ•´ç†ä¸€ä¸‹é¢ç»ï¼ˆè®°å½•ä¸€äº›æ˜ åƒæ¯”è¾ƒæ·±çš„å§ï¼‰ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>å‰æ®µæ—¶é—´è¾èŒæ¢å·¥ä½œï¼Œå‚åŠ äº†ä¸€äº›é¢è¯•ï¼Œç°åœ¨ä¹Ÿå…¥èŒäº†ï¼Œè¶ç€è¿˜ä¸å¿™ç¨å¾®æ•´ç†ä¸€ä¸‹é¢ç»ï¼ˆè®°å½•ä¸€äº›æ˜ åƒæ¯”è¾ƒæ·±çš„å§ï¼‰ã€‚</p>
<!-- more -->
<h2 id="å¹¿å·-çˆ±æ‹">å¹¿å·-çˆ±æ‹</h2>
<p>ç»™æˆ‘æ˜ åƒæœ€æ·±çš„å°±æ˜¯å®ƒçš„ç¬”è¯•é¢˜äº†ï¼Œæ•´æ•´4é¡µï¼Œè¿˜æ˜¯åŒé¢çš„ï¼Œè€Œä¸”å¾ˆå¤šé—®é¢˜éƒ½æœ‰å¥½å‡ é—®çš„...<br>
å‹‰å¼ºè®°å¾—çš„å‡ ä¸ªé¢˜ï¼š</p>
<ul>
<li>TCPä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹</li>
<li>TCPä¸UDPåŒºåˆ«</li>
<li>sessionä¸cookieçš„åŒºåˆ«</li>
<li>TCPå‘é€æ•°æ®åŒ…ä¸æ¥æ”¶æ•°æ®åŒ…çš„è¿‡ç¨‹</li>
<li>æµè§ˆå™¨è¾“å…¥ç½‘å€åˆ°æ˜¾ç¤ºé¡µé¢å…¶èƒŒåç»å†çš„è¿‡ç¨‹</li>
<li>è¿˜æœ‰ä¸€äº›ç³»ç»Ÿè®¾è®¡çš„é¢˜</li>
<li>ç®—æ³•ï¼šæœ€é•¿å…¬å…±å­—ä¸²</li>
<li>...</li>
</ul>
<p>é¢è¯•é¢˜è®°ä¸æ¸…äº†ï¼ŒåŸºæœ¬ä¸Šæ˜¯é¡¹ç›®ç›¸å…³ã€‚</p>
<h2 id="å¹¿å·-4399">å¹¿å·-4399</h2>
<p>ç­‰äº†ä¸€ä¼šé¢è¯•å®˜æ‰è¿‡æ¥ï¼Œçœ‹èµ·æ¥æŒºå¿™çš„ğŸ˜‚</p>
<ol>
<li>Rediså¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œé™¤äº†äº”ç§åŸºæœ¬æ•°æ®ç»“æ„å¤–è¿˜æœ‰ä»€ä¹ˆæ•°æ®ç»“æ„ï¼Ÿ</li>
</ol>
<blockquote>
<p>string, list, hash, set, zset, HyperLogLog, GEO, bitmap</p>
</blockquote>
<ol start="2">
<li>Redisæ˜¯å•çº¿ç¨‹çš„å—ï¼Ÿå•çº¿ç¨‹æ˜¯æŒ‡å“ªä¸ªæ¨¡å—æ˜¯å•çº¿ç¨‹ï¼Ÿä¸ºä»€ä¹ˆå•çº¿ç¨‹è¿˜èƒ½ä¿æŒè¶…é«˜æ€§èƒ½ï¼Ÿ</li>
</ol>
<blockquote>
<p>Redis 6ä¹‹å‰æ˜¯å•çº¿ç¨‹ï¼Œä¹‹åæ˜¯å¤šçº¿ç¨‹ï¼›I/Oæ¨¡å—ï¼›epoll I/Oå¤ç”¨æ¨¡å‹</p>
</blockquote>
<ol start="3">
<li>select, poll, epollçš„åŒºåˆ«ï¼Ÿ</li>
<li>è¿œè·ç¦»ä¸¤åœ°çš„MySQLæ•°æ®åŒæ­¥ï¼Œå¦‚ä½•å®ç°ï¼Ÿå¼‚åœ°å¤šæ´»æœ‰äº†è§£è¿‡å—ï¼Ÿ</li>
</ol>
<blockquote>
<p>æ²¡å›ç­”ä¸Šæ¥ï¼›å¬è¯´è¿‡ï¼Œæ²¡æ·±å…¥äº†è§£</p>
</blockquote>
<ol start="5">
<li>...</li>
</ol>
<p>ç¬¬äºŒé¢å› ä¸ºæ—¶é—´åŸå› æ²¡å‚åŠ äº†ï¼ˆHRä¸€ç›´è®©æˆ‘åœ¨é‚£ç­‰...ï¼‰</p>
<h2 id="å¹¿å·-çˆ†ç±³ç§‘æŠ€">å¹¿å·-çˆ†ç±³ç§‘æŠ€</h2>
<ol>
<li>php-fpmæ˜¯ä»€ä¹ˆä»¥åŠå®ƒçš„å·¥ä½œæµç¨‹</li>
<li>cgiã€fast-cgiçš„åŒºåˆ«</li>
<li>MySQLæ‰§è¡Œä¸€æ¡SQLæ—¶çš„æµç¨‹</li>
</ol>
<blockquote>
<p>å¤§æ¦‚æ˜¯ï¼šæƒé™æ ¡éªŒ-&gt;è¯æ³•åˆ†æ-&gt;è¯­æ³•åˆ†æ-&gt;è¯­ä¹‰åˆ†æ-&gt;ä¼˜åŒ–å™¨è¿›è¡Œä¼˜åŒ–-&gt;å­˜å‚¨å¼•æ“æŸ¥è¯¢æ•°æ®</p>
</blockquote>
<ol start="4">
<li>Redisé€šè¿‡é”®æ‰¹é‡è·å–å€¼æ—¶ï¼Œå¦‚æœæ•°æ®æ¯”è¾ƒå¤šä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ</li>
</ol>
<blockquote>
<p>å°†éœ€è¦è·å–çš„é”®è¿›è¡Œåˆ†ç‰‡ï¼Œä¾æ¬¡è·å–</p>
</blockquote>
<ol start="5">
<li>PHPä¸­å¯¹æ•°ç»„è¿›è¡Œåˆ†ç‰‡çš„å‡½æ•°</li>
</ol>
<blockquote>
<p>array_chunk</p>
</blockquote>
<ol start="6">
<li>...</li>
</ol>
<p>å¬é¢è¯•å®˜è¯´ï¼Œå¥½åƒæ˜¯è½¬è½¬çš„æŠ€æœ¯å›¢é˜ŸäºŒæ¬¡åˆ›ä¸šã€‚æ¯”è¾ƒæ»¡æ„çš„ä¸€å®¶ï¼Œå¯æƒœåé¢æ‰“ç®—å»æ·±åœ³äº†ï¼Œåªèƒ½æ”¾å¼ƒäº†ã€‚</p>
<h2 id="å¹¿å·-ç½‘æ˜“æ¸¸æˆ">å¹¿å·-ç½‘æ˜“æ¸¸æˆ</h2>
<ol>
<li>Redisåˆ é™¤ä¸€ä¸ªå¤§æ•°æ®é”®å€¼æ—¶ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</li>
<li>éœ€è¦ä»ä¸‰ä¸ªç‰©å“A, B, Cä¸­éšæœºå–å‡ºä¸€ä¸ªï¼Œå¦‚ä½•ç”¨ä¸€æšç¡¬å¸åšåˆ°ç­‰æ¦‚ç‡å–ï¼Ÿ</li>
</ol>
<blockquote>
<p>æœ€ç®€å•çš„å°±æ˜¯æŠ›ä¸¤æ¬¡ï¼Œä¼šæœ‰å››ç§å¯èƒ½ï¼Œå–å…¶ä¸­ä¸‰ç§è·Ÿä¸‰ä¸ªç‰©å“ä¸€ä¸€å¯¹åº”ï¼Œå¦‚æœæ˜¯ç¬¬å››ç§å°±é‡æ–°æŠ›ã€‚</p>
</blockquote>
<ol start="3">
<li>æ¥å£æ€§èƒ½æ¯”è¾ƒå·®ï¼Œå¦‚ä½•æ’æŸ¥ï¼Ÿ</li>
<li>è®©ä½ å®ç°ä¸€ä¸ªè¿æ¥æ± ï¼Œå¦‚ä½•å®ç°ï¼Ÿ</li>
<li>OAuth 2.0å®‰å…¨é—®é¢˜</li>
<li>é¢äº†æŒºä¹…çš„ï¼Œé—®å¾—æ¯”è¾ƒæ·±ï¼Œåªè®°å¾—ä¸€ç‚¹äº†...</li>
</ol>
<blockquote>
<p>åæ¥åˆ°æ·±åœ³ä¹Ÿé¢äº†ä¸å°‘ï¼Œä½†æ˜¯å¾ˆå¤šéƒ½è®°ä¸èµ·æ¥äº†ï¼Œåç»­æœ‰æƒ³èµ·æ¥å†æ›´æ–°å§ã€‚</p>
</blockquote>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[PostgreSQLçš„jsonã€jsonbã€æ•°ç»„]]></title>
        <id>/post/kYHKCQzOh/</id>
        <link href="/post/kYHKCQzOh/">
        </link>
        <updated>2021-06-14T13:09:40.000Z</updated>
        <summary type="html"><![CDATA[<p>æœ€è¿‘å·¥ä½œä¸­æ¥è§¦åˆ°PostgreSQLï¼Œæ‰€ä»¥ç¨å¾®å­¦ä¹ ä¸‹å®ƒçš„å‡ ç§æ•°æ®ç±»å‹ï¼š<code>json</code>ã€<code>jsonb</code>ã€æ•°ç»„ä»¥åŠç›¸å¯¹åº”çš„æ•°æ®æŸ¥è¯¢ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>æœ€è¿‘å·¥ä½œä¸­æ¥è§¦åˆ°PostgreSQLï¼Œæ‰€ä»¥ç¨å¾®å­¦ä¹ ä¸‹å®ƒçš„å‡ ç§æ•°æ®ç±»å‹ï¼š<code>json</code>ã€<code>jsonb</code>ã€æ•°ç»„ä»¥åŠç›¸å¯¹åº”çš„æ•°æ®æŸ¥è¯¢ã€‚</p>
<!-- more -->
<blockquote>
<p>PostgreSQLä¸­å•å¼•å·ç”¨äºè¡¨ç¤ºå­—ç¬¦ä¸²å€¼ï¼ŒåŒå¼•å·ç”¨äºè¡¨ç¤ºç³»ç»Ÿæ ‡è¯†ç¬¦ï¼Œæ²¡æœ‰åå¼•å·`ã€‚</p>
</blockquote>
<h2 id="json-jsonb">JSONã€JSONB</h2>
<h3 id="jsonå’Œjsonbçš„å¼‚åŒ"><code>json</code>å’Œ<code>jsonb</code>çš„å¼‚åŒ</h3>
<p>åœ¨PostgreSQLä¸­ï¼Œ<code>json</code>å’Œ<code>jsonb</code>éƒ½æ˜¯ç”¨æ¥å­˜å‚¨<code>json</code>æ•°æ®çš„ã€‚</p>
<p>ä½¿ç”¨<code>json</code>ç±»å‹æ—¶ï¼ŒPostgreSQLä¼šå°†è¾“å…¥çš„<code>json</code>æ–‡æœ¬å­˜å‚¨èµ·æ¥ï¼ŒåŒ…æ‹¬å…¶ä¸­çš„ç©ºæ ¼ä»¥åŠé”®çš„é¡ºåºï¼Œåœ¨æŸ¥è¯¢ä½¿ç”¨æ—¶æ‰å»è§£æã€‚è€Œ<code>jsonb</code>ç±»å‹ä¼šå°†è¾“å…¥çš„<code>json</code>æ–‡æœ¬è§£æä¸ºå¯¹åº”çš„äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œå­˜å‚¨ã€‚<code>jsonb</code>ç±»å‹ç›¸è¾ƒ<code>json</code>ç±»å‹è€Œè¨€æ›´é«˜æ•ˆï¼Œæ€§èƒ½æ›´å¥½ï¼Œä¸”æ”¯æŒå»ºç«‹ç´¢å¼•ã€‚</p>
<h3 id="jsonåŠjsonbçš„ç›¸å…³sqlæ“ä½œ"><code>json</code>åŠ<code>jsonb</code>çš„ç›¸å…³SQLæ“ä½œ</h3>
<h4 id="è¡¨çš„åˆ›å»º">è¡¨çš„åˆ›å»º</h4>
<pre><code class="language-sql">-- åˆ›å»ºæµ‹è¯•è¡¨
CREATE TABLE test (
    id int not null primary key,
    attr_json json not null,
    attr_jsonb jsonb not null
);
</code></pre>
<h4 id="æ•°æ®æ’å…¥">æ•°æ®æ’å…¥</h4>
<pre><code class="language-sql">INSERT INTO test (id, attr_json, attr_jsonb)
VALUES (1, '{&quot;name&quot;:&quot;anhoder&quot;,&quot;age&quot;:18}', '{&quot;name&quot;:&quot;anhoder&quot;,&quot;age&quot;:18}'),
       (2, '{&quot;name&quot;:&quot;jane&quot;,&quot;age&quot;:34,&quot;son&quot;: {&quot;name&quot;:&quot;coco&quot;,&quot;age&quot;:1}}', '{&quot;name&quot;:&quot;jane&quot;,&quot;age&quot;:34,&quot;son&quot;: {&quot;name&quot;:&quot;coco&quot;,&quot;age&quot;:1}}'),
       (3, '{&quot;name&quot;:&quot;alan&quot;,&quot;age&quot;:35,&quot;son&quot;: {&quot;name&quot;:&quot;coney&quot;,&quot;age&quot;:1}}', '{&quot;name&quot;:&quot;alan&quot;,&quot;age&quot;:35,&quot;son&quot;: {&quot;name&quot;:&quot;coney&quot;,&quot;age&quot;:1}}'),
       (4, '{&quot;name&quot;:&quot;jojo&quot;,&quot;age&quot;:26}', '{&quot;name&quot;:&quot;jojo&quot;,&quot;age&quot;:26}');
</code></pre>
<p>æ’å…¥åçš„ç»“æœï¼š</p>
<figure data-type="image" tabindex="1"><img src="/post-images/1623679477303.png" alt="æ’å…¥ç»“æœ" loading="lazy"></figure>
<p>å¯è§<code>jsonb</code>ä¼šå¯¹æ•°æ®è¿›è¡Œè§£æåï¼Œå†è¿›è¡Œå­˜å‚¨ï¼Œ<code>json</code>åˆ™å­˜å‚¨åŸè¾“å…¥ã€‚</p>
<h4 id="æ•°æ®æŸ¥è¯¢">æ•°æ®æŸ¥è¯¢</h4>
<pre><code class="language-sql">-- -&gt; è·å–å¯¹è±¡çš„å±æ€§ï¼Œç»“æœä½œä¸ºjsonå¯¹è±¡ï¼›-&gt;&gt;è·å–å¯¹è±¡çš„å±æ€§ï¼Œç»“æœä½œä¸ºæ–‡æœ¬
select attr_json-&gt;'son'-&gt;'age' as son_age, attr_json-&gt;&gt;'son' as son_text from test;
</code></pre>
<figure data-type="image" tabindex="2"><img src="/post-images/1623680145772.png" alt="ç»“æœ1" loading="lazy"></figure>
<hr>
<pre><code class="language-sql">-- #&gt; æ ¹æ®è·¯å¾„è·å–ç»“æœä½œä¸ºjsonå¯¹è±¡ï¼›#&gt;&gt; æ ¹æ®è·¯å¾„è·å–ç»“æœä½œä¸ºæ–‡æœ¬(json, jsonbç»“æœä¸€è‡´)
select attr_json#&gt;'{son}'-&gt;'age' as son_age, attr_json#&gt;'{son,age}' as son_age2, attr_json#&gt;&gt;'{son}' as son_text from test;
</code></pre>
<figure data-type="image" tabindex="3"><img src="/post-images/1623680312500.png" alt="ç»“æœ2" loading="lazy"></figure>
<hr>
<pre><code class="language-sql">-- @&gt;å·¦è¾¹æ˜¯å¦åŒ…å«å³è¾¹ï¼›&lt;@å³è¾¹æ˜¯å¦åŒ…å«å·¦è¾¹ (jsonbå¯ç”¨)
select * from test where attr_jsonb@&gt;'{&quot;age&quot;:18}';
</code></pre>
<figure data-type="image" tabindex="4"><img src="/post-images/1623680487862.png" alt="ç»“æœ3" loading="lazy"></figure>
<hr>
<pre><code class="language-sql">-- ? æ˜¯å¦å­˜åœ¨å±æ€§
select * from test where attr_jsonb ? 'name';
</code></pre>
<hr>
<pre><code class="language-sql">-- ?| å­˜åœ¨æ•°ç»„ä¸­ä»»æ„ä¸€ä¸ªå±æ€§åˆ™ä¸ºtrue (jsonbå¯ç”¨)
select * from test where attr_jsonb ?| array ['son', 'name'];
</code></pre>
<figure data-type="image" tabindex="5"><img src="/post-images/1623680779281.png" alt="ç»“æœ4" loading="lazy"></figure>
<hr>
<pre><code class="language-sql">-- ?&amp; åŒæ—¶å­˜åœ¨æ•°ç»„ä¸­çš„æ‰€æœ‰å±æ€§åˆ™ä¸ºtrue (jsonbå¯ç”¨)
select * from test where attr_jsonb ?&amp; array ['son', 'name'];
</code></pre>
<figure data-type="image" tabindex="6"><img src="/post-images/1623680893730.png" alt="ç»“æœ5" loading="lazy"></figure>
<hr>
<pre><code class="language-sql">-- ::ä¸ºç±»å‹è½¬æ¢
select * from test where (attr_json-&gt;&gt;'age')::int&gt;20;
</code></pre>
<figure data-type="image" tabindex="7"><img src="/post-images/1623681132425.png" alt="ç»“æœ6" loading="lazy"></figure>
<h4 id="æ•°æ®æ›´æ–°">æ•°æ®æ›´æ–°</h4>
<pre><code class="language-sql">-- jsonb_set(jsonb old_jsonb, text[] path, jsonb new_jsonb, bool create_if_missing) æ›´æ–°jsonb 
update test set attr_jsonb=jsonb_set(attr_jsonb, '{son}', '{&quot;name&quot;:&quot;con&quot;,&quot;age&quot;:2}')
where (attr_jsonb#&gt;&gt;'{son,name}') = 'coco';
</code></pre>
<hr>
<pre><code class="language-sql">-- æ ¹æ®è·¯å¾„åˆ é™¤å±æ€§ (jsonbå¯ç”¨)
update test set attr_jsonb=attr_jsonb#-'{son,name}';
</code></pre>
<hr>
<pre><code class="language-sql">-- åˆ é™¤å±æ€§ (jsonbå¯ç”¨)
update test set attr_jsonb=attr_jsonb-'son' where attr_jsonb ? 'son';
</code></pre>
<h2 id="æ•°ç»„">æ•°ç»„</h2>
<pre><code class="language-sql">-- åˆ›å»ºæµ‹è¯•è¡¨
CREATE TABLE test_arr (
    id int not null primary key,
    arr int[] not null
);

-- æ’å…¥æ•°æ®
insert into test_arr (id, arr) values (1, array[2,3,4]),(2, array[3,4,5]);

-- æ•°ç»„åˆå¹¶
select array[1,2,3,4] || array[2,3,4,5]; -- ç»“æœï¼š{1,2,3,4,2,3,4,5}
select 2 || array[2,3,4,5]; -- ç»“æœï¼š{2,2,3,4,5}

-- æ•°ç»„æ¯”è¾ƒï¼Œæ¯ä¸ªå…ƒç´ ä¾æ¬¡æ¯”è¾ƒå¤§å°
select array[1,2,3,4] &gt; array[1,2,3]; -- ç»“æœ: true
select array[1,2,3,4] &gt; array[1,2,4]; -- ç»“æœ: false

-- æ•°ç»„åŒ…å«å…³ç³»
select array[1,2,3] @&gt; array[2,3]; -- ç»“æœ: true
select array[1,2,3] @&gt; array[2,3,4]; -- ç»“æœ: false

-- æ•°ç»„æ˜¯å¦æœ‰å…±åŒå…ƒç´ 
select array[1,2,3] &amp;&amp; array[3,4,5]; -- ç»“æœ: true
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[musicfox 2.0â€”â€”golangé‡å†™ç‰ˆ]]></title>
        <id>/post/NOO340v6g/</id>
        <link href="/post/NOO340v6g/">
        </link>
        <updated>2021-05-14T12:51:23.000Z</updated>
        <summary type="html"><![CDATA[<p>musicfox 2.0ç»ˆäºå®Œæˆäº†ï¼Œæ²¡æœ‰å¤ªå¤šçš„åŠŸèƒ½å˜æ›´ï¼Œä¸»è¦ä½¿ç”¨golangè¿›è¡Œé‡å†™ï¼Œä¼˜åŒ–äº†ç”¨æˆ·ä½“éªŒï¼ˆä¸»è¦æ˜¯Windowsä¸‹ï¼‰ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>musicfox 2.0ç»ˆäºå®Œæˆäº†ï¼Œæ²¡æœ‰å¤ªå¤šçš„åŠŸèƒ½å˜æ›´ï¼Œä¸»è¦ä½¿ç”¨golangè¿›è¡Œé‡å†™ï¼Œä¼˜åŒ–äº†ç”¨æˆ·ä½“éªŒï¼ˆä¸»è¦æ˜¯Windowsä¸‹ï¼‰ã€‚</p>
<!-- more -->
<h2 id="å­˜åœ¨çš„é—®é¢˜ä¸æ–¹æ¡ˆ">å­˜åœ¨çš„é—®é¢˜ä¸æ–¹æ¡ˆ</h2>
<p>musicfoxæœ€å¼€å§‹æ˜¯ç”¨Dartå†™çš„ï¼Œå·¥ä½œåŸç†å¤§è‡´æ˜¯ä¸»è¿›ç¨‹forkä¸€ä¸ªmpg123çš„å­è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹å¤„ç†UIæ¸²æŸ“ã€ç”¨æˆ·äº¤äº’åŠç½‘ç»œè¯·æ±‚ç­‰ï¼Œç„¶åé€šè¿‡è¿›ç¨‹é—´ç®¡é“é€šä¿¡ï¼Œæ¥æ§åˆ¶mpg123å­è¿›ç¨‹çš„éŸ³ä¹æ’­æ”¾ã€æš‚åœä»¥åŠæ’­æ”¾å™¨çš„éŸ³é‡å¤§å°ç­‰ã€‚</p>
<p>è¿™ç§æ¨¡å¼ä¸‹ï¼Œä¼šå­˜åœ¨ä»¥ä¸‹è¿™äº›é—®é¢˜ï¼š</p>
<ul>
<li>ä¾èµ–mpg123ï¼Œéœ€è¦ç”¨æˆ·æ‰‹åŠ¨å®‰è£…mpg123</li>
<li>mpg123åªèƒ½æ’­æ”¾mp3éŸ³ä¹ï¼Œç½‘æ˜“äº‘æ— æŸéŸ³è´¨æ˜¯flacæ ¼å¼ï¼Œæ— æ³•æ’­æ”¾</li>
<li>è¿›ç¨‹é—´éœ€è¦é€šè¿‡ç®¡é“è¿›è¡Œé€šä¿¡ï¼ŒWindowsä¸‹ä¸å®¹æ˜“å¤„ç†</li>
<li>Dartå¤§å¤šæ•°ä¸‰æ–¹åŒ…éƒ½æ˜¯åŸºäºFlutterçš„ï¼ŒåŸç”ŸåŒ…ä¸å¤š</li>
<li>...</li>
</ul>
<p>ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œäºæ˜¯å¼€å§‹é‡‡ç”¨golangè¿›è¡Œé‡å†™ï¼Œä¼˜åŠ¿ä¸»è¦æ˜¯ï¼š</p>
<ul>
<li>golangæ”¯æŒæ›´å¤šå¹³å°çš„äºŒè¿›åˆ¶ç¼–è¯‘</li>
<li>æ‹¥æœ‰ä¸°å¯Œçš„ç¬¬ä¸‰æ–¹åŒ…ï¼Œä¾‹å¦‚éŸ³é¢‘æ’­æ”¾çš„<a href="https://github.com/faiface/beep">beep</a>ã€TUIæ¸²æŸ“çš„<br>
<a href="https://github.com/charmbracelet/bubbletea">bubbletea</a>ã€æœ¬åœ°æ•°æ®åº“çš„<a href="https://github.com/boltdb/bolt">bolt</a>ç­‰ç­‰</li>
<li>ä¸éœ€è¦å€ŸåŠ©å…¶ä»–è¿›ç¨‹ï¼Œæ‰€ä»¥ä¸å­˜åœ¨è¿›ç¨‹é€šä¿¡</li>
<li>æ”¯æŒmp3ã€flacã€wavç­‰æ ¼å¼éŸ³é¢‘æ–‡ä»¶çš„è§£ç æ’­æ”¾</li>
<li>goroutine + chan</li>
</ul>
<p>å¦å¤–å¯¹æˆ‘è‡ªå·±æ¥è¯´å¯ä»¥æ·±å…¥ç†Ÿæ‚‰golang...</p>
<h2 id="ä½¿ç”¨goæ—¶é‡åˆ°çš„é—®é¢˜">ä½¿ç”¨goæ—¶é‡åˆ°çš„é—®é¢˜</h2>
<h3 id="åç¨‹æ³„æ¼">åç¨‹æ³„æ¼</h3>
<p>åœ¨ä½¿ç”¨golangè¿‡ç¨‹ä¸­é‡åˆ°æ¯”è¾ƒä¸¥é‡çš„é—®é¢˜å°±æ˜¯åç¨‹æ³„æ¼ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p>
<pre><code class="language-go">package main

import (
	&quot;fmt&quot;
	&quot;runtime&quot;
)

func main() {
	c1 := make(chan struct{})
	for i := 0; i &lt; 10; i++ {
		go test(c1)
		fmt.Println(runtime.NumGoroutine())
	}
}

func test(c chan&lt;- struct{}) {
	c &lt;- struct{}{}
}
</code></pre>
<p>æ‰§è¡Œåä¼šè¾“å‡ºï¼š</p>
<pre><code>2
3
4
5
6
7
8
9
10
11
</code></pre>
<p>å¯è§ï¼Œåç¨‹æ•°ä¸€ç›´åœ¨å¢åŠ ï¼Œè¿™æ˜¯å› ä¸ºæ²¡æœ‰æ¶ˆè´¹è€…æ¶ˆè´¹chanä¸­çš„æ•°æ®ï¼Œæ‰€æœ‰å­åç¨‹éƒ½é˜»å¡åœ¨å†™chançš„æ“ä½œã€‚</p>
<p>ç±»ä¼¼è¿™ç§æƒ…å†µå°±ä¼šå¯¼è‡´åç¨‹æ•°ä¸æ–­å¢é•¿ï¼Œå‡ºç°åç¨‹æ³„æ¼ï¼Œå†…å­˜å ç”¨ä¸æ–­ä¸Šå‡ã€‚</p>
<h3 id="å¦‚ä½•å°½é‡é¿å…åç¨‹æ³„æ¼">å¦‚ä½•å°½é‡é¿å…åç¨‹æ³„æ¼</h3>
<ol>
<li>ç¡®ä¿chanéƒ½ä¼šæœ‰ç›¸åº”çš„æ¶ˆè´¹è€…ã€ç”Ÿäº§è€…ï¼Œä¸”ç”Ÿäº§é€Ÿåº¦å’Œæ¶ˆè´¹é€Ÿåº¦å·®ä¸å¤š</li>
<li>å¦‚æœéœ€è¦å¾€chanä¸­å‹æ•°æ®æˆ–è¯»æ•°æ®ï¼Œä½†åˆä¸ç¡®å®šæ˜¯å¦æœ‰æ¶ˆè´¹è€…æˆ–ç”Ÿäº§è€…ï¼Œå¯ä»¥ä½¿ç”¨<code>select</code>ç»“æ„é¿å…é˜»å¡</li>
<li>ä½¿ç”¨goroutine + chanå¤„ç†ï¼Œé¿å…åˆ›å»ºå¤§é‡åç¨‹ï¼Œä¾‹å¦‚ï¼š</li>
</ol>
<pre><code class="language-go">package main

import (
	&quot;fmt&quot;
	&quot;runtime&quot;
	&quot;time&quot;
)

func main() {
	var data [100]string
	// è·å–dataé€»è¾‘
	for _, v := range data {
		go test(v)
	}

	fmt.Println(runtime.NumGoroutine())
}

func test(s string) {
	// å‡è£…ä¸šåŠ¡é€»è¾‘
	time.Sleep(time.Millisecond)
}
</code></pre>
<p>è¾“å‡ºä¸º: 101ï¼Œä¹Ÿå°±æ˜¯æ–°å¼€äº†100ä¸ªåç¨‹ï¼Œå¦‚æœæ•°æ®æ›´å¤šæ—¶ï¼Œä¼šäº§ç”Ÿæ›´å¤šåç¨‹ã€‚è¿™ç§æƒ…å†µå¯ä»¥è€ƒè™‘åˆ›å»ºå›ºå®šæ•°é‡çš„è‹¥å¹²ä¸ªåç¨‹ï¼Œç„¶åé€šè¿‡chanå°†æ•°æ®æŠ•é€’ç»™å­åç¨‹è¿›è¡Œå¤„ç†ï¼Œé¿å…å¤§é‡åç¨‹å ç”¨å†…å­˜ï¼Œå¦‚ï¼š</p>
<pre><code class="language-go">package main

import (
	&quot;fmt&quot;
	&quot;runtime&quot;
	&quot;time&quot;
)

func main() {
	var data [100]string
	c := make(chan string)

	for i := 0; i &lt; 5; i++ {
		go test(c)
	}

	for _, v := range data {
		c &lt;- v
	}

	fmt.Println(runtime.NumGoroutine())
}

func test(c &lt;-chan string) {
	for _ = range c {
        // ä¸šåŠ¡é€»è¾‘
		time.Sleep(time.Millisecond)
	}
}
</code></pre>
<h3 id="åç¨‹æ³„æ¼æ’æŸ¥">åç¨‹æ³„æ¼æ’æŸ¥</h3>
<ol>
<li>runtime.NumGoroutine()æŸ¥çœ‹åç¨‹æ•°</li>
<li>ä½¿ç”¨gopsæ’æŸ¥ï¼Œå¯ä»¥æŸ¥çœ‹å½“å‰åç¨‹æ•°ã€è°ƒç”¨æ ˆç­‰</li>
</ol>
<h2 id="é¢„è§ˆ">é¢„è§ˆ</h2>
<figure data-type="image" tabindex="1"><img src="/post-images/1620999111458.png" alt="preview1" loading="lazy"></figure>
<figure data-type="image" tabindex="2"><img src="/post-images/1620999246727.png" alt="preview2" loading="lazy"></figure>
<h2 id="å®‰è£…">å®‰è£…</h2>
<h3 id="mac">Mac</h3>
<p>æä¾›ä¸¤ç§æ–¹å¼å®‰è£…ï¼š</p>
<h4 id="ä½¿ç”¨brewå®‰è£…">ä½¿ç”¨brewå®‰è£…</h4>
<pre><code class="language-sh">brew tap anhoder/go-musicfox &amp;&amp; brew install go-musicfox
</code></pre>
<p>å¦‚æœä½ ä¹‹å‰å®‰è£…è¿‡musicfoxï¼Œéœ€è¦ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤é‡æ–°é“¾æ¥:</p>
<pre><code class="language-sh">brew unlink musicfox &amp;&amp; brew link --overwrite go-musicfox
</code></pre>
<h4 id="ç›´æ¥ä¸‹è½½">ç›´æ¥ä¸‹è½½</h4>
<p>ä¸‹è½½<a href="https://github.com/anhoder/go-musicfox/releases/latest/download/musicfox.mac">Macå¯æ‰§è¡Œæ–‡ä»¶</a>ï¼Œåœ¨iTermæˆ–Terminalä¸­æ‰“å¼€</p>
<h3 id="linux">Linux</h3>
<p>èº«è¾¹æ²¡æœ‰Linuxè®¾å¤‡ï¼Œè€Œæ’­æ”¾éŸ³ä¹ä¾èµ–CGOï¼Œæ— æ³•è¿›è¡Œäº¤å‰ç¼–è¯‘ï¼Œæ‰€ä»¥æš‚æ—¶æ²¡æœ‰å¯ç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶</p>
<h3 id="windows">Windows</h3>
<p>ä¸‹è½½<a href="https://github.com/anhoder/go-musicfox/releases/latest/download/musicfox.exe">Windowså¯æ‰§è¡Œæ–‡ä»¶</a>ï¼Œåœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œå³å¯ã€‚</p>
<p><strong>æ¨èä½¿ç”¨Windows Terminalï¼ŒUIåŠä½“éªŒä¼šå¥½å¾ˆå¤š</strong></p>
<h2 id="å¿«æ·é”®">å¿«æ·é”®</h2>
<table>
<thead>
<tr>
<th>æŒ‰é”®</th>
<th>ä½œç”¨</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>h/H/LEFT</td>
<td>å·¦</td>
<td></td>
</tr>
<tr>
<td>l/L/RIGHT</td>
<td>å³</td>
<td></td>
</tr>
<tr>
<td>k/K/UP</td>
<td>ä¸Š</td>
<td></td>
</tr>
<tr>
<td>j/J/DOWN</td>
<td>ä¸‹</td>
<td></td>
</tr>
<tr>
<td>q/Q</td>
<td>é€€å‡º</td>
<td></td>
</tr>
<tr>
<td>space</td>
<td>æš‚åœ/æ’­æ”¾</td>
<td></td>
</tr>
<tr>
<td>[</td>
<td>ä¸Šä¸€æ›²</td>
<td></td>
</tr>
<tr>
<td>]</td>
<td>ä¸‹ä¸€æ›²</td>
<td></td>
</tr>
<tr>
<td>-</td>
<td>å‡å°éŸ³é‡</td>
<td></td>
</tr>
<tr>
<td>=</td>
<td>åŠ å¤§éŸ³é‡</td>
<td></td>
</tr>
<tr>
<td>n/N/ENTER</td>
<td>è¿›å…¥é€‰ä¸­çš„èœå•</td>
<td></td>
</tr>
<tr>
<td>b/B/ESC</td>
<td>è¿”å›ä¸Šçº§èœå•</td>
<td></td>
</tr>
<tr>
<td>w/W</td>
<td>é€€å‡ºå¹¶é€€å‡ºç™»å½•</td>
<td></td>
</tr>
<tr>
<td>p</td>
<td>åˆ‡æ¢æ’­æ”¾æ–¹å¼</td>
<td></td>
</tr>
<tr>
<td>P</td>
<td>å¿ƒåŠ¨æ¨¡å¼(ä»…åœ¨æ­Œå•ä¸­æ—¶æœ‰æ•ˆ)</td>
<td></td>
</tr>
<tr>
<td>r/R</td>
<td>é‡æ–°æ¸²æŸ“UI</td>
<td>Windowsè°ƒæ•´çª—å£å¤§å°åï¼Œæ²¡æœ‰äº‹ä»¶è§¦å‘ï¼Œå¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•æ‰‹åŠ¨é‡æ–°æ¸²æŸ“</td>
</tr>
<tr>
<td>,</td>
<td>å–œæ¬¢å½“å‰æ’­æ”¾æ­Œæ›²</td>
<td></td>
</tr>
<tr>
<td>&lt;</td>
<td>å–œæ¬¢å½“å‰é€‰ä¸­æ­Œæ›²</td>
<td></td>
</tr>
<tr>
<td>.</td>
<td>å½“å‰æ’­æ”¾æ­Œæ›²ç§»é™¤å‡ºå–œæ¬¢</td>
<td></td>
</tr>
<tr>
<td>&gt;</td>
<td>å½“å‰é€‰ä¸­æ­Œæ›²ç§»é™¤å‡ºå–œæ¬¢</td>
<td></td>
</tr>
<tr>
<td>/</td>
<td>æ ‡è®°å½“å‰æ’­æ”¾æ­Œæ›²ä¸ºä¸å–œæ¬¢</td>
<td></td>
</tr>
<tr>
<td>?</td>
<td>æ ‡è®°å½“å‰é€‰ä¸­æ­Œæ›²ä¸ºä¸å–œæ¬¢</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="todo">TODO</h2>
<ul class="contains-task-list">
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox" id="task-item-5199826"><label class="task-list-item-label" for="task-item-5199826"> æˆ‘çš„æ­Œå•</label></li>
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox" id="task-item-2995627"><label class="task-list-item-label" for="task-item-2995627"> æ¯æ—¥æ¨èæ­Œæ›²</label></li>
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox" id="task-item-6699580"><label class="task-list-item-label" for="task-item-6699580"> æ¯æ—¥æ¨èæ­Œå•</label></li>
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox" id="task-item-40129"><label class="task-list-item-label" for="task-item-40129"> ç§äººFM</label></li>
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox" id="task-item-3541240"><label class="task-list-item-label" for="task-item-3541240"> æ­Œè¯æ˜¾ç¤º</label></li>
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox" id="task-item-2765460"><label class="task-list-item-label" for="task-item-2765460"> æ¬¢è¿ç•Œé¢</label></li>
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox" id="task-item-2294458"><label class="task-list-item-label" for="task-item-2294458"> æœç´¢</label>
<ul class="contains-task-list">
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox" id="task-item-4326314"><label class="task-list-item-label" for="task-item-4326314"> æŒ‰æ­Œæ›²</label></li>
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox" id="task-item-4760697"><label class="task-list-item-label" for="task-item-4760697"> æŒ‰æ­Œæ‰‹</label></li>
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox" id="task-item-7686047"><label class="task-list-item-label" for="task-item-7686047"> æŒ‰æ­Œè¯</label></li>
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox" id="task-item-3006557"><label class="task-list-item-label" for="task-item-3006557"> æŒ‰æ­Œå•</label></li>
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox" id="task-item-3223931"><label class="task-list-item-label" for="task-item-3223931"> æŒ‰ä¸“è¾‘</label></li>
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox" id="task-item-2406345"><label class="task-list-item-label" for="task-item-2406345"> æŒ‰ç”¨æˆ·</label></li>
</ul>
</li>
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox" id="task-item-392455"><label class="task-list-item-label" for="task-item-392455"> æ’è¡Œæ¦œ</label></li>
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox" id="task-item-1886885"><label class="task-list-item-label" for="task-item-1886885"> ç²¾é€‰æ­Œå•</label></li>
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox" id="task-item-4104402"><label class="task-list-item-label" for="task-item-4104402"> æœ€æ–°ä¸“è¾‘</label></li>
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox" id="task-item-3865003"><label class="task-list-item-label" for="task-item-3865003"> çƒ­é—¨æ­Œæ‰‹</label></li>
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox" id="task-item-9816105"><label class="task-list-item-label" for="task-item-9816105"> äº‘ç›˜</label></li>
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox" id="task-item-529452"><label class="task-list-item-label" for="task-item-529452"> æ’­æ”¾æ–¹å¼åˆ‡æ¢</label></li>
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox" id="task-item-6797767"><label class="task-list-item-label" for="task-item-6797767"> å–œæ¬¢/å–æ¶ˆå–œæ¬¢</label></li>
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox" id="task-item-7298932"><label class="task-list-item-label" for="task-item-7298932"> å¿ƒåŠ¨æ¨¡å¼/æ™ºèƒ½æ¨¡å¼</label></li>
<li class="task-list-item"><input class="task-list-item-checkbox" checked="" disabled="" type="checkbox" id="task-item-8758227"><label class="task-list-item-label" for="task-item-8758227"> éŸ³ä¹ç”µå°</label></li>
<li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox" id="task-item-4944270"><label class="task-list-item-label" for="task-item-4944270"> é…ç½®æ–‡ä»¶</label></li>
<li class="task-list-item"><input class="task-list-item-checkbox" disabled="" type="checkbox" id="task-item-6905001"><label class="task-list-item-label" for="task-item-6905001"> é€šçŸ¥åŠŸèƒ½</label></li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ä¸€ä¸ªutoolsæ’ä»¶â€”â€”hasidsåŠ è§£å¯†]]></title>
        <id>/post/YMhNrwxuT/</id>
        <link href="/post/YMhNrwxuT/">
        </link>
        <updated>2021-03-22T12:07:53.000Z</updated>
        <summary type="html"><![CDATA[<p>å·¥ä½œä¸­ç”¨åˆ°äº†hashidsåŠ å¯†ç®—æ³•ï¼Œå¼€å‘æµ‹è¯•æ—¶ç»å¸¸éœ€è¦å¯¹æŸä¸ªIDæˆ–hashidè¿›è¡ŒåŠ å¯†ã€è§£å¯†ï¼Œä¸ºäº†æé«˜æ•ˆç‡ï¼Œå‘¨æœ«èŠ±äº†ç‚¹æ—¶é—´åŸºäº<code>otp</code>å°è£…äº†ä¸€ä¸ªutoolsæ’ä»¶â€”â€”<code>hashids</code>ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>å·¥ä½œä¸­ç”¨åˆ°äº†hashidsåŠ å¯†ç®—æ³•ï¼Œå¼€å‘æµ‹è¯•æ—¶ç»å¸¸éœ€è¦å¯¹æŸä¸ªIDæˆ–hashidè¿›è¡ŒåŠ å¯†ã€è§£å¯†ï¼Œä¸ºäº†æé«˜æ•ˆç‡ï¼Œå‘¨æœ«èŠ±äº†ç‚¹æ—¶é—´åŸºäº<code>otp</code>å°è£…äº†ä¸€ä¸ªutoolsæ’ä»¶â€”â€”<code>hashids</code>ã€‚</p>
<!-- more -->
<p>utoolsæ˜¯ä»€ä¹ˆå°±ä¸å¤šè¯´äº†ï¼Œè¿™é‡Œä¸»è¦è¯´ä¸€ä¸‹<code>hashids</code>æ’ä»¶çš„ä½¿ç”¨ã€‚</p>
<blockquote>
<p>GitHubåœ°å€: <a href="https://github.com/anhoder/utools-hashids">https://github.com/anhoder/utools-hashids</a></p>
</blockquote>
<h2 id="æ·»åŠ hashidsé…ç½®">æ·»åŠ hashidsé…ç½®</h2>
<p>hashidsåŠ è§£å¯†éœ€è¦é…ç½®saltåŠæœ€å°é•¿åº¦ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å…³é”®å­—è¿›å»æ·»åŠ é…ç½®çš„æ­¥éª¤:</p>
<ul>
<li>hadd</li>
<li>hash-add</li>
<li>hashæ·»åŠ é…ç½®</li>
</ul>
<figure data-type="image" tabindex="1"><img src="/post-images/1617624599510.png" alt="æ·»åŠ é…ç½®" loading="lazy"></figure>
<p>è¿›å…¥ä¹‹åï¼Œä¾æ¬¡è¾“å…¥<code>åç§°</code>-<code>salt</code>-<code>æœ€å°é•¿åº¦</code>å³å¯ä¿å­˜é…ç½®ã€‚</p>
<blockquote>
<p>å¦‚æœæœ‰å¤šä¸ªç¯å¢ƒé…ç½®ï¼Œå¤šæ¬¡æ·»åŠ å³å¯ï¼Œ<strong>åç§°ä¸å¯é‡å¤</strong>ã€‚</p>
</blockquote>
<h2 id="hashidsåŠ å¯†">hashidsåŠ å¯†</h2>
<p>hashidsåŠ å¯†æœ‰ä¸¤ç§æ–¹å¼è¿›å…¥ï¼Œä¸€ç§æ˜¯ä½¿ç”¨å…³é”®å­—ï¼š</p>
<ul>
<li>haen</li>
<li>hash-encode</li>
<li>hashç¼–ç </li>
</ul>
<p>è¿›å…¥ä¹‹åï¼Œè¾“å…¥ä½ æƒ³è¦åŠ å¯†çš„IDï¼Œåˆ—è¡¨ä¸­ä¼šæ˜¾ç¤ºä½ å·²æœ‰é…ç½®çš„åŠ å¯†ç»“æœï¼Œå›è½¦å³å¯å¤åˆ¶ï¼Œå¦‚ï¼š</p>
<figure data-type="image" tabindex="2"><img src="/post-images/1617626324547.png" alt="hashidsåŠ å¯†" loading="lazy"></figure>
<p>å¦å¤–ä¸€ç§æ–¹æ³•æ˜¯ç›´æ¥åœ¨<code>utools</code>çš„ä¸»è¾“å…¥æ¡†å†…è¾“å…¥éœ€è¦åŠ å¯†çš„IDï¼Œé€‰æ‹©<code>hashç¼–ç </code>è¿›å…¥ï¼Œå›è½¦å³å¯å¤åˆ¶ã€‚</p>
<blockquote>
<ol>
<li>å¦‚æœä½ å¼€å¯äº†utoolsçš„å³é”®è¶…çº§é¢æ¿ï¼Œå°±æ›´æ–¹ä¾¿äº†ï¼Œåªéœ€è¦é•¿æŒ‰å³é”®ä½ çš„IDï¼Œé€‰æ‹©<code>hashç¼–ç </code>å³å¯ã€‚</li>
<li>å¦‚æœä½ éœ€è¦åˆ é™¤é…ç½®ï¼Œåœ¨è¿›å…¥ä¹‹åä½¿ç”¨<code>control</code>+<code>enter</code>æˆ–<code>command</code>+<code>enter</code>å³å¯åˆ é™¤é€‰ä¸­çš„é…ç½®é¡¹ã€‚</li>
</ol>
</blockquote>
<h2 id="hashidsè§£å¯†">hashidsè§£å¯†</h2>
<p>è§£å¯†å’ŒåŠ å¯†å·®ä¸å¤šï¼Œå°±ä¸èµ˜è¿°äº†ï¼Œå…³é”®å­—ï¼š</p>
<ul>
<li>hade</li>
<li>hash-decode</li>
<li>hashè§£ç </li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[PHPä¸­ä¸€äº›å¥½ç”¨çš„æŠ€å·§]]></title>
        <id>/post/O933qcq8E/</id>
        <link href="/post/O933qcq8E/">
        </link>
        <updated>2021-02-28T12:06:47.000Z</updated>
        <summary type="html"><![CDATA[<p>è¿™é‡Œä¸»è¦ä»‹ç»ä¸€äº›æˆ‘çŸ¥é“çš„PHPçš„ä½¿ç”¨æŠ€å·§ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>è¿™é‡Œä¸»è¦ä»‹ç»ä¸€äº›æˆ‘çŸ¥é“çš„PHPçš„ä½¿ç”¨æŠ€å·§ã€‚</p>
<!-- more -->
<h2 id="1-phpå†…ç½®çš„web-server">1ã€PHPå†…ç½®çš„Web Server</h2>
<p>é¦–å…ˆï¼Œæœ‰ä¸ªé—®é¢˜ï¼š</p>
<blockquote>
<p>å¦‚æœä½ éœ€è¦å¿«é€Ÿå¯åŠ¨ä¸€ä¸ªHTTPæœåŠ¡æ¥è°ƒè¯•PHPä»£ç ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ</p>
</blockquote>
<p><em>å¯åŠ¨php-fpmæˆ–php-cgiè¿›ç¨‹ç›‘å¬9000ç«¯å£ï¼Œç„¶åä½¿ç”¨Nginxå°†Httpè¯·æ±‚é€šè¿‡FastCGIæ¥å£è½¬å‘ç»™php-fpmæˆ–php-cgiè¿›ç¨‹ï¼Ÿ</em></p>
<p>è¿™ä¸å¤±ä¸ºä¸€ç§æ–¹æ³•ï¼Œä½†æ˜¯å¹¶ä¸ç®—æ–¹ä¾¿ã€‚</p>
<p>å…¶å®ï¼ŒPHP 5.4.0åå°±æä¾›äº†ä¸€ä¸ªå†…ç½®çš„WebæœåŠ¡å™¨ï¼Œä½ å¯ä»¥æ‰§è¡Œè¿™ä¸ªå‘½ä»¤æ¥å¯åŠ¨å®ƒ:</p>
<pre><code class="language-sh">php -S 127.0.0.1:8080 a.php
</code></pre>
<p>ç„¶åå°±é€šè¿‡ http://127.0.0.1:8080 æ¥è¿›è¡Œè®¿é—®äº†ã€‚</p>
<h2 id="2-æ‰§è¡Œphpä»£ç æ—¶ç”Ÿæˆdebugä¿¡æ¯">2ã€æ‰§è¡ŒPHPä»£ç æ—¶ç”Ÿæˆdebugä¿¡æ¯</h2>
<blockquote>
<p>åœ¨æ‰§è¡ŒPHPä»£ç æ—¶ï¼Œä½ ä¼šç”¨ä»€ä¹ˆæ–¹æ³•è¿›è¡Œè°ƒè¯•ï¼Ÿ</p>
</blockquote>
<p><em>var_dumpã€print_rç›´æ¥è¾“å‡ºï¼Ÿ</em></p>
<p>é™¤äº†ç›´æ¥è¾“å‡ºï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨debugæ¨¡å¼é…åˆIDEæ¥è¿›è¡Œè°ƒè¯•ã€‚åœ¨æ‰§è¡ŒPHPä»£ç æ—¶ï¼ŒåŠ ä¸Š<code>-e</code>å‚æ•°ï¼ŒåŒæ—¶IDEå¼€å¯debugç›‘å¬ï¼ˆéœ€è¦å®‰è£…xdebugæˆ–yasdç­‰è°ƒè¯•ç±»æ‰©å±•ï¼Œæ¨èyasdï¼Œå®ƒå¯ä»¥è°ƒè¯•swooleåç¨‹ï¼‰:</p>
<pre><code class="language-sh">php -e a.php

php -e artisan test:test
</code></pre>
<p>è¿™æ ·ä½ å°±å¯ä»¥ä½¿ç”¨IDEçš„debugåŠŸèƒ½æ¥è°ƒè¯•ä½ çš„PHPå‘½ä»¤äº†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é…åˆPHPçš„å†…ç½®WebæœåŠ¡å™¨ä¸€èµ·ä½¿ç”¨ï¼š</p>
<pre><code class="language-sh">php -e -S 127.0.0.1:8080 a.php
</code></pre>
<h2 id="3-æ•°ç»„è¿­ä»£">3ã€æ•°ç»„è¿­ä»£</h2>
<blockquote>
<p>éœ€è¦è·å–è¿™ä¸ªæ•°ç»„æ‰€æœ‰å±‚çº§çš„å­å…ƒç´ ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ</p>
<pre><code class="language-php">$arr = [
  'key1' =&gt; 'value1',
  'key2' =&gt; [
      'key3' =&gt; 'value2',
      'key4' =&gt; [
          'value3',
          'value4',
      ]
  ],
  'key5' =&gt; 'value5'
];
</code></pre>
</blockquote>
<p><em>ä½¿ç”¨é€’å½’ï¼Ÿ</em></p>
<p>æ²¡é”™ï¼Œå¯ä»¥ä½¿ç”¨é€’å½’ã€‚ä½ ä¹Ÿå¯ä»¥é€‰æ‹©å¦å¤–ä¸€ç§æ–¹å¼ï¼š</p>
<pre><code class="language-php">$arr = [
    'key1' =&gt; 'value1',
    'key2' =&gt; [
        'key3' =&gt; 'value2',
        'key4' =&gt; [
            'value3',
            'value4',
        ]
    ],
    'key5' =&gt; 'value5'
];

$it = new RecursiveArrayIterator($arr);
$recursiveIt = new RecursiveIteratorIterator($it);
foreach ($recursiveIt as $v) {
    var_dump($v);
}
</code></pre>
<h2 id="4-ç›®å½•è¿­ä»£">4ã€ç›®å½•è¿­ä»£</h2>
<blockquote>
<p>éœ€è¦è·å–ä¸€ä¸ªç›®å½•ä¸‹æ‰€æœ‰å±‚çº§çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ</p>
</blockquote>
<p><em>è¿™æ ·ä½¿ç”¨dirè¿­ä»£ï¼Ÿ</em></p>
<pre><code class="language-php">function test($dir) {
    $dirHandle = dir($dir);
    while ($item = $dirHandle-&gt;read()) {
        if ($item == '.' || $item == '..') continue;
        $path = &quot;{$dir}/{$item}&quot;;
        if (is_dir($path)) {
            test($path);
        } else {
            var_dump($item);
        }
    }
}
</code></pre>
<p>ä½ è¿˜å¯ä»¥ç”¨æ›´ç®€å•çš„æ–¹æ³•ï¼ŒåŒæ ·ä¹Ÿæ˜¯PHPå†…ç½®çš„è¿­ä»£å™¨:</p>
<pre><code class="language-php">$it = new RecursiveDirectoryIterator('./');
$reIt = new RecursiveIteratorIterator($it);

foreach ($reIt as $value) {
    var_dump($value);
}
</code></pre>
<h2 id="5-è®¿é—®å¯¹è±¡çš„ç§æœ‰å±æ€§">5ã€è®¿é—®å¯¹è±¡çš„ç§æœ‰å±æ€§</h2>
<blockquote>
<p>åœ¨ä½¿ç”¨ä¸€ä¸ªåº“çš„å¯¹è±¡æ—¶ï¼Œæƒ³è¦è®¿é—®è¯¥å¯¹è±¡çš„ç§æœ‰å±æ€§ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ</p>
</blockquote>
<p><em>?</em></p>
<p>å¯ä»¥ä½¿ç”¨<code>Closure</code>ç±»çš„é™æ€æ–¹æ³•<code>bind</code>æˆ–éé™æ€æ–¹æ³•<code>bindTo</code>å°†å‡½æ•°ç»‘å®šåˆ°è¯¥ç±»çš„ä½œç”¨åŸŸä¸‹ï¼š</p>
<pre><code class="language-php">class A {
    private $name = 'The name of A';
}

$a = new A();

// æ–¹æ³•ä¸€
$closure = Closure::bind(function () use ($a) {
    var_dump($a-&gt;name);
}, null, A::class);

// æ–¹æ³•äºŒï¼Œé€šè¿‡thisè®¿é—®
//$closure = Closure::bind(function () {
//    var_dump($this-&gt;name);
//}, $a, A::class);

$closure();
</code></pre>
<h2 id="6-fastcgi_request_finish">6ã€fastcgi_request_finish</h2>
<p>fastcgi_request_finishå‡½æ•°æ˜¯PHPæä¾›çš„åœ¨CGIæ¨¡å¼ä¸‹å¯ç”¨çš„æ–¹æ³•ã€‚</p>
<p>è°ƒç”¨æ­¤æ–¹æ³•ä¼šå°†å“åº”æ•°æ®ç«‹å³å‘é€ç»™ç”¨æˆ·ï¼Œä½†ä¸ä¸­æ–­åç»­ä»£ç æ‰§è¡Œã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-php">echo 123;
echo 456;

fastcgi_finish_request(); // æ­¤æ—¶å°†å“åº”å‘é€ç»™ç”¨æˆ·

echo 789;

file_put_contents('a.txt', '789');
</code></pre>
<p>ä»¥ä¸Šä»£ç åœ¨CGIæ¨¡å¼ä¸‹æ‰§è¡Œï¼Œä½ ä¼šå¾—åˆ°123456çš„å“åº”æ•°æ®ï¼Œå¹¶ä¸”ä¼šç”Ÿæˆa.txtæ–‡ä»¶ï¼Œå†…å®¹ä¸º789ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ç”¨é€”å°±æ˜¯è·³è¿‡ä¸å“åº”æ— å…³çš„æ•°æ®å¤„ç†ï¼Œæå‰è¿”å›æ•°æ®ç»™å®¢æˆ·ç«¯ï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€‚</p>
<blockquote>
<p>ä»…åœ¨CGIæ¨¡å¼ä¸‹å¯ç”¨ï¼Œå…¶ä»–æ¨¡å¼ä¸‹ä¼šæŠ¥æ–¹æ³•ä¸å­˜åœ¨çš„é”™è¯¯</p>
<p>Laravelä¸­Responseçš„sendæ–¹æ³•ä¹Ÿæ˜¯ç”¨åˆ°äº†è¿™ä¸ªå‡½æ•°</p>
</blockquote>
<h2 id="7-ç»­">7ã€ç»­...</h2>
<p><em>åç»­è¡¥å……...</em></p>
]]></content>
    </entry>
</feed>